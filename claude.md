# clinic-waiting-display

ふじみ野ひかり眼科の待合室向けデジタルサイネージWebアプリケーション。花粉情報、天気予報、スライドショー、CMを自動ローテーション表示する。

## 技術スタック

- **フロントエンド**: Vanilla JavaScript (ES6+), HTML5, CSS3
- **外部API**: 気象庁 JMA API（天気予報・気温）
- **ストレージ**: LocalStorage（キャッシュ用）
- **アニメーション**: Canvas API、CSS Animations
- **動画**: HTML5 Video (MP4)
- **フォント**: Google Fonts (Noto Sans JP, 多言語対応)

## ディレクトリ構造

```
├── 待合室患者情報提供ディスプレイ.html  # メインHTML（9種類の画面定義）
├── css/style.css                        # スタイルシート
├── js/main.js                           # メインロジック
├── images/                              # スライドショー画像
│   └── config.json                      # 画像リスト（自動生成）
├── cm/                                  # CM動画ファイル
├── settings.json                        # 全体設定（表示時間、CM設定）
├── 画像リスト更新_Windows用.bat         # 画像リスト自動生成
└── 画像リスト更新_Chromebook用.sh       # 同上（Linux/Mac用）
```

## 主要機能

### 画面タイプ
1. **花粉カレンダー** - 7種類の花粉の月別飛散レベル表示
2. **花粉アラート** - 今月注意すべき花粉の警告
3. **対策ポイント** - 花粉症対策のアドバイス
4. **スライドショー** - 医療情報画像（分割表示対応）
5. **CM** - ビリヤードロゴ/パーティクル/ファミコン風/動画
6. **時計** - 現在時刻と日付
7. **天気予報** - 気象庁APIから3日分取得
8. **紫外線情報** - UVインデックス表示
9. **多言語グリッド** - 18言語でクリニック名表示

### 画面ローテーション
```
基本画面 → スライドショー → CM → 後半固定画面 → ループ（2時間で自動リロード）
```

## 設定ファイル

### settings.json
- `screens`: 各画面の表示時間（秒）
- `cm.animations[]`: CM設定（type: "animation" | "video"）
- `cm.animations[].followedBy`: CM後に挿入する追加画面

### images/config.json
画像ファイル名規則:
- `{順番}_{秒数}_{説明}.{拡張子}` - 基本形式
- `{順番}_{秒数}_{分割数}_{説明}.{拡張子}` - 分割表示
- ファイル名末尾が `_CM` → そこでCM挿入

## 開発・実行

### 実行方法
ブラウザで `待合室患者情報提供ディスプレイ.html` を開く（ビルド不要）

### 画像追加手順
1. `images/` フォルダに画像を配置（命名規則に従う）
2. `画像リスト更新_*.bat/.sh` を実行
3. `images/config.json` が自動更新される

### 操作
- **スペースキー**: 次の画面へ強制進行

## コード構成 (js/main.js)

### 主要オブジェクト
- `CONFIG`: 表示時間、アニメーション設定
- `pollenData`: 花粉種類と月別飛散データ
- `weatherData`: 気象庁APIから取得した天気データ

### 主要関数
- `startRotation()`: 画面ローテーション開始
- `showNextScreen()`: 次の画面表示
- `playCM()`: CM再生（アニメーション/動画）
- `fetchWeatherData()`: 気象庁API呼び出し
- `startBilliardAnimation()`: ビリヤードロゴアニメーション
- `startParticleAnimation()`: パーティクルアニメーション
- `startFamicomAnimation()`: ファミコン風アニメーション

## 注意事項

- 気象庁APIは1時間キャッシュ（連続アクセス回避）
- 2時間ごとに自動リロード（メモリリーク対策）
- 日本語ファイル名を使用（UTF-8エンコーディング必須）
- GitHub Pages でデモ公開中
