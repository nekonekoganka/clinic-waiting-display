<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èŠ±ç²‰é£›æ•£æƒ…å ±ï¼ˆå¤©æ°—äºˆå ±è¿½åŠ ç‰ˆï¼‰</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap');

        :root {
            --bg-color: #f0f4f8;
            --container-bg: white;
            --header-bg: #4a90e2;
            --header-border: #357abd;
            --header-text: white;
            --border-color: #ddd;
            --text-color-dark: #34495e;
            --text-color-light: #6c757d;
            --card-accent-color: #1a5f9e;
            --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --tree-high: #ff4444;
            --tree-medium: #ff8844;
            --tree-low: #ffdd44;
            --grass-high: #2d5a5a;
            --grass-medium: #4d8a8a;
            --grass-low: #8dd8d8;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Noto Sans JP', 'Hiragino Sans', 'Yu Gothic', sans-serif; background-color: var(--bg-color); height: 100vh; overflow: hidden; }
        .container { width: 100%; height: 100vh; background-color: var(--container-bg); display: flex; flex-direction: column; }
        .table-container { flex-grow: 1; overflow: hidden; padding: 10px 10px 5px 10px; display: flex; align-items: stretch; }
        table { width: 100%; border-collapse: collapse; font-size: clamp(11px, 1.2vw, 16px); table-layout: fixed; }
        
        .header { background-color: var(--header-bg); color: var(--header-text); font-weight: bold; }
        .header th { padding: clamp(4px, 0.8vh, 10px) 2px; text-align: center; border: 1px solid var(--header-border); font-size: clamp(21.6px, 3.6vh, 38.4px); font-weight: bold; vertical-align: middle; white-space: nowrap; }
        .header th:first-child { width: clamp(150px, 15vw, 225px); }
        
        .current-month-column {
            position: relative;
            box-shadow: -6px 0 0 0 #ff6b6b inset, 6px 0 0 0 #ff6b6b inset;
            animation: pulse-border 1.8s infinite ease-in-out;
        }

        .header .current-month-column {
            background-color: var(--tree-high);
            border-color: #c0392b;
            animation: pulse-border 1.8s infinite ease-in-out, pulse-header-red 1.8s infinite ease-in-out;
        }
        
        .plant-name { background-color: #f8f9fa; font-weight: bold; padding: clamp(6px, 1vh, 10px) clamp(6px, 0.8vw, 10px); border: 1px solid var(--border-color); width: 100%; height: clamp(40px, 6vh, 55px); vertical-align: middle; font-size: clamp(25.5px, 3.9vh, 31.5px); }
        tbody tr, tbody tr td { height: clamp(40px, 6vh, 55px); }
        td { padding: clamp(3px, 0.5vh, 8px); border: 1px solid var(--border-color); text-align: center; position: relative; vertical-align: middle; }
        
        .tree-high { background-color: var(--tree-high); } .tree-medium { background-color: var(--tree-medium); } .tree-low { background-color: var(--tree-low); }
        .grass-high { background-color: var(--grass-high); } .grass-medium { background-color: var(--grass-medium); } .grass-low { background-color: var(--grass-low); }
        
        .current-month-info { flex-shrink: 0; padding: clamp(15px, 2.5vh, 25px); background: linear-gradient(135deg, #eef7ff 0%, #ffffff 100%); border-top: 4px solid var(--header-bg); display: flex; align-items: stretch; gap: clamp(15px, 2vw, 25px); max-height: 40vh; }
        
        .pollen-info-card { flex: 0 0 35%; background-color: var(--container-bg); padding: clamp(10px, 1.5vh, 20px); border-radius: 12px; box-shadow: var(--card-shadow); display: flex; flex-direction: column; gap: clamp(8px, 1.2vh, 12px); overflow-y: auto; }
        .pollen-info-card h2 { font-size: clamp(20px, 3.2vh, 30px); font-weight: bold; color: var(--card-accent-color); text-align: center; flex-shrink: 0; }
        #pollen-details { display: flex; flex-direction: column; gap: clamp(6px, 1vh, 10px); }
        
        .tips-info-card { flex: 1; background-color: var(--container-bg); padding: clamp(10px, 1.5vh, 20px); border-radius: 12px; box-shadow: var(--card-shadow); display: flex; flex-direction: column; }
        .tips-info-card .tips-title { font-size: clamp(22px, 3.5vh, 28px); font-weight: bold; color: var(--card-accent-color); text-align: center; margin-bottom: clamp(10px, 1.5vh, 15px); }
        .tips-info-card .tips-grid { display: flex; gap: clamp(10px, 1.5vw, 20px); }
        .tips-info-card .tip { flex: 1; text-align: center; background-color: #f8fcff; padding: clamp(10px, 2vh, 20px); border-radius: 8px; border: 1px solid #dbeaf5; }
        .tips-info-card .tip strong { color: var(--card-accent-color); display: block; margin-bottom: 2px; font-size: clamp(24px, 3.9vh, 30px); }
        .tips-info-card .tip p { font-size: clamp(21px, 3.3vh, 27px); line-height: 1.5; color: var(--text-color-dark); font-weight: bold; }
        
        .bottom-area { margin-top: auto; padding-top: 10px; }
        .clinic-message { text-align: center; font-size: clamp(22.5px, 3.6vh, 28.5px); color: #588db9; font-weight: bold; padding: 5px; }
        .source-citation-bottom { text-align: center; font-size: clamp(13.5px, 1.8vh, 16.5px); color: var(--text-color-light); padding-top: 5px; font-weight: bold; }
        
        .pollen-item { display: flex; align-items: center; padding: clamp(8px, 1.2vh, 12px) 150px; background-color: #f8f9fa; border-radius: 8px; border-left: 5px solid; }
        .pollen-item-name { font-weight: bold; font-size: clamp(14px, 2.2vh, 18px); color: var(--text-color-dark); margin-right: auto; }
        .pollen-item-level { font-size: clamp(13px, 2vh, 16px); font-weight: bold; color: var(--text-color-dark); }
        
        .pollen-item.tree-high { border-color: var(--tree-high); } .pollen-item.tree-medium { border-color: var(--tree-medium); } .pollen-item.tree-low { border-color: var(--tree-low); }
        .pollen-item.grass-high { border-color: var(--grass-high); } .pollen-item.grass-medium { border-color: var(--grass-medium); } .pollen-item.grass-low { border-color: var(--grass-low); }

        .info-message { text-align: center; font-size: clamp(13px, 2vh, 16px); color: #555; padding: 10px; background-color: #f8f9fa; border-radius: 8px; }

        @keyframes pulse-red {
            0% { background-color: #f8f9fa; box-shadow: none; }
            50% { background-color: #ffeaea; box-shadow: 0 0 10px rgba(255, 68, 68, 0.7); }
            100% { background-color: #f8f9fa; box-shadow: none; }
        }
        .pollen-item-high-alert {
            animation: pulse-red 1.8s infinite ease-in-out;
        }

        @keyframes pulse-border {
            0% { box-shadow: -6px 0 0 0 #ff6b6b inset, 6px 0 0 0 #ff6b6b inset; }
            50% { box-shadow: -6px 0 0 0 rgba(255, 107, 107, 0.2) inset, 6px 0 0 0 rgba(255, 107, 107, 0.2) inset; }
            100% { box-shadow: -6px 0 0 0 #ff6b6b inset, 6px 0 0 0 #ff6b6b inset; }
        }

        @keyframes pulse-header-red {
            0% { background-color: var(--tree-high); }
            50% { background-color: #ff8080; }
            100% { background-color: var(--tree-high); }
        }

        /* ========== ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ ========== */
        .fullscreen-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.8s ease, visibility 0.8s ease;
        }
        .fullscreen-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        /* èŠ±ç²‰æ³¨æ„ç”»é¢ */
        .pollen-alert-screen {
            background: linear-gradient(145deg, #fff9e6 0%, #fff3cd 30%, #ffe8a8 100%);
        }
        .pollen-alert-content {
            text-align: center;
            padding: 20px;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .pollen-alert-icon {
            font-size: clamp(100px, 15vh, 150px);
            margin-bottom: 10px;
            animation: float 3s ease-in-out infinite;
        }
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }
        .pollen-alert-month {
            font-size: clamp(60px, 10vh, 100px);
            color: #b8860b;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .pollen-alert-title {
            font-size: clamp(70px, 12vh, 120px);
            color: #d35400;
            font-weight: bold;
            margin-bottom: 30px;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.15);
        }
        .pollen-alert-list {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 25px;
            max-width: 95%;
        }
        .pollen-alert-item {
            background: white;
            border-radius: 24px;
            padding: 30px 50px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.12);
            display: flex;
            align-items: center;
            gap: 20px;
            transition: transform 0.3s ease;
        }
        .pollen-alert-item:hover {
            transform: scale(1.05);
        }
        .pollen-alert-item-icon {
            font-size: clamp(50px, 8vh, 80px);
        }
        .pollen-alert-item-info {
            text-align: left;
        }
        .pollen-alert-item-name {
            font-size: clamp(42px, 7vh, 70px);
            font-weight: bold;
            color: #333;
        }
        .pollen-alert-item-level {
            font-size: clamp(32px, 5vh, 50px);
            font-weight: bold;
            padding: 8px 20px;
            border-radius: 12px;
            display: inline-block;
            margin-top: 8px;
        }
        .level-high { background: #ffcccc; color: #c0392b; }
        .level-medium { background: #ffe0b3; color: #d35400; }
        .level-low { background: #fff3cd; color: #b8860b; }

        /* å¯¾ç­–ãƒã‚¤ãƒ³ãƒˆç”»é¢ */
        .tips-screen {
            background: linear-gradient(145deg, #e8f5e9 0%, #c8e6c9 30%, #a5d6a7 100%);
        }
        .tips-fullscreen-content {
            text-align: center;
            padding: 15px 30px;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .tips-fullscreen-icon {
            font-size: clamp(60px, 8vh, 90px);
            margin-bottom: 5px;
        }
        .tips-fullscreen-title {
            font-size: clamp(50px, 7vh, 75px);
            color: #2e7d32;
            font-weight: bold;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.12);
        }
        .tips-fullscreen-grid {
            display: flex;
            flex-direction: column;
            justify-content: center;
            gap: 15px;
            width: 90%;
            max-width: 1400px;
        }
        .tips-fullscreen-card {
            background: white;
            border-radius: 20px;
            padding: 20px 40px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.12);
            display: flex;
            align-items: center;
            gap: 30px;
            transition: transform 0.3s ease;
        }
        .tips-fullscreen-card:hover {
            transform: translateX(10px);
        }
        .tips-card-icon {
            font-size: clamp(50px, 7vh, 80px);
            flex-shrink: 0;
        }
        .tips-card-content {
            display: flex;
            align-items: center;
            gap: 25px;
            flex-grow: 1;
        }
        .tips-card-title {
            font-size: clamp(36px, 5vh, 55px);
            color: #1b5e20;
            font-weight: bold;
            flex-shrink: 0;
            min-width: 180px;
        }
        .tips-card-text {
            font-size: clamp(30px, 4vh, 45px);
            color: #333;
            line-height: 1.4;
            text-align: left;
        }
        .tips-fullscreen-footer {
            margin-top: 20px;
            font-size: clamp(32px, 4.5vh, 48px);
            color: #388e3c;
            font-weight: bold;
        }
        .tips-fullscreen-footer-icon {
            font-size: clamp(38px, 5vh, 55px);
            vertical-align: middle;
            margin-right: 10px;
        }

        /* ========== ç”»åƒã‚¹ãƒ©ã‚¤ãƒ‰ã‚·ãƒ§ãƒ¼ç”»é¢ ========== */
        .slideshow-screen {
            background-color: #ffffff;
        }
        .slideshow-image {
            max-width: 100%;
            max-height: 100%;
            width: auto;
            height: auto;
            object-fit: contain;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }

        /* ========== æ™‚è¨ˆè¡¨ç¤ºç”»é¢ ========== */
        .clock-screen {
            background-color: #f5f5f5;
            flex-direction: column;
        }
        .clock-screen.active {
            display: flex;
        }
        .clock-content {
            text-align: center;
            color: #333333;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding: 40px 20px;
        }
        .clock-date-weekday-section {
            margin-bottom: 40px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 30px;
        }
        .clock-date-display {
            display: flex;
            justify-content: center;
            align-items: flex-end;
            gap: 15px;
            line-height: 1;
        }
        .clock-date-display .number {
            font-size: clamp(150px, 22vh, 240px);
            font-weight: 700;
            margin-left: 0.2em;
        }
        .clock-date-display ruby {
            display: inline-flex;
            flex-direction: column-reverse;
            font-size: clamp(75px, 11vh, 120px);
            font-weight: 700;
        }
        .clock-date-display rt {
            font-size: clamp(50px, 7vh, 80px);
            font-weight: 400;
            letter-spacing: 2px;
        }
        .clock-weekday-section {
            line-height: 1.2;
        }
        .clock-weekday-ruby {
            font-size: clamp(50px, 7vh, 80px);
            font-weight: 400;
            margin-bottom: 5px;
            letter-spacing: 8px;
        }
        .clock-weekday-main {
            font-size: clamp(100px, 14vh, 160px);
            font-weight: 700;
            letter-spacing: 4px;
        }
        .clock-time-section {
            margin-bottom: 20px;
        }
        .clock-time-display {
            display: flex;
            justify-content: center;
            align-items: flex-end;
            gap: 15px;
            line-height: 1;
        }
        .clock-time-display .number {
            font-size: clamp(120px, 17vh, 190px);
            font-weight: 700;
            margin-left: 0.2em;
        }
        .clock-time-display ruby {
            display: inline-flex;
            flex-direction: column-reverse;
            font-size: clamp(60px, 8.5vh, 95px);
            font-weight: 700;
        }
        .clock-time-display rt {
            font-size: clamp(30px, 4.2vh, 48px);
            font-weight: 400;
            letter-spacing: 2px;
            text-align: center;
            display: block;
        }
        .clock-time-display .seconds-number {
            font-size: clamp(80px, 11vh, 130px);
            font-weight: 700;
            margin-left: 0.2em;
        }
        .clock-time-display .seconds-kanji {
            display: inline-flex;
            flex-direction: column-reverse;
            font-size: clamp(40px, 5.6vh, 65px);
            font-weight: 700;
        }
        .clock-time-display .seconds-kanji rt {
            font-size: clamp(20px, 2.8vh, 32px);
            font-weight: 400;
            letter-spacing: 2px;
            text-align: center;
            display: block;
        }
        .clock-logo-section {
            padding: 10px 20px 30px 20px;
            text-align: center;
        }
        .clock-logo-section img {
            max-width: 95%;
            width: 95%;
            height: auto;
            object-fit: contain;
            transform: scale(0.855);
            box-shadow: 5px 5px 10px rgba(0,0,0,0.3);
        }

        /* ========== ãƒ­ã‚´ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç”»é¢ ========== */
        .logo-animation-screen {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        }
        .logo-animation-screen.active {
            display: flex;
        }
        .logo-animation-container {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        #particleCanvas {
            max-width: 95vw;
            max-height: 95vh;
            width: auto;
            height: auto;
        }

        /* ========== å¤©æ°—äºˆå ±ç”»é¢ ========== */
        .weather-screen {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #4a90e2 100%);
            transition: background 0.5s ease;
        }
        /* æœï¼ˆ5-10æ™‚ï¼‰: æ—¥ã®å‡ºã®ã‚ªãƒ¬ãƒ³ã‚¸ã‹ã‚‰æ°´è‰² */
        .weather-screen.time-morning {
            background: linear-gradient(135deg, #ff9a56 0%, #ffbe76 30%, #74b9ff 100%);
        }
        /* æ˜¼ï¼ˆ10-16æ™‚ï¼‰: æ™´ã‚Œæ¸¡ã‚‹é’ç©º */
        .weather-screen.time-noon {
            background: linear-gradient(135deg, #4facfe 0%, #00c6fb 50%, #74b9ff 100%);
        }
        /* å¤•æ–¹ï¼ˆ16-19æ™‚ï¼‰: å¤•ç„¼ã‘ */
        .weather-screen.time-evening {
            background: linear-gradient(135deg, #fa709a 0%, #ff9472 30%, #fee140 100%);
        }
        /* å¤œï¼ˆ19-5æ™‚ï¼‰: å¤œç©º */
        .weather-screen.time-night {
            background: linear-gradient(135deg, #0c1445 0%, #1a237e 50%, #283593 100%);
        }
        .weather-screen.active {
            display: flex;
        }
        .weather-content {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 40px;
            color: white;
        }
        .weather-header {
            text-align: center;
            margin-bottom: 40px;
        }
        .weather-location {
            font-size: clamp(36px, 5vh, 50px);
            font-weight: bold;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        .weather-update-time {
            font-size: clamp(18px, 2.5vh, 24px);
            opacity: 0.9;
        }
        .weather-cards {
            display: flex;
            justify-content: center;
            gap: clamp(15px, 2vw, 40px);
            width: 100%;
            max-width: 1800px;
            flex-wrap: wrap;
        }
        .weather-card {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 24px;
            padding: clamp(20px, 3vh, 40px) clamp(25px, 3vw, 50px);
            text-align: center;
            flex: 1 1 280px;
            max-width: 380px;
            min-width: 280px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
            border: 1px solid rgba(255,255,255,0.2);
        }
        .weather-card-date {
            font-size: clamp(28px, 4vh, 40px);
            font-weight: bold;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(255,255,255,0.3);
        }
        .weather-card-icon {
            font-size: clamp(80px, 12vh, 140px);
            margin: 20px 0;
            filter: drop-shadow(3px 3px 5px rgba(0,0,0,0.3));
        }
        .weather-card-text {
            font-size: clamp(24px, 3.5vh, 36px);
            font-weight: bold;
            margin-bottom: 25px;
            min-height: 2.5em;
            line-height: 1.3;
        }
        .weather-card-temps {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 20px;
        }
        .weather-temp {
            font-size: clamp(28px, 4vh, 42px);
            font-weight: bold;
        }
        .weather-temp-high {
            color: #ffcccc;
        }
        .weather-temp-low {
            color: #cce5ff;
        }
        .weather-temp-label {
            font-size: clamp(14px, 2vh, 18px);
            opacity: 0.8;
        }
        .weather-card-rain {
            font-size: clamp(22px, 3vh, 30px);
            background: rgba(255,255,255,0.2);
            padding: 10px 20px;
            border-radius: 12px;
            display: inline-block;
        }
        .weather-card-rain-icon {
            margin-right: 8px;
        }
        .weather-loading {
            font-size: clamp(32px, 5vh, 48px);
            text-align: center;
        }
        .weather-source {
            margin-top: 40px;
            font-size: clamp(16px, 2vh, 20px);
            opacity: 0.7;
        }

        /* ========== ãƒ•ã‚¡ãƒŸã‚³ãƒ³é¢¨ãƒ­ã‚´ç”»é¢ ========== */
        .famicom-logo-screen {
            background: #000000;
        }
        .famicom-logo-screen.active {
            display: flex;
        }
        .famicom-logo-container {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        #famicomCanvas {
            image-rendering: pixelated;
            image-rendering: crisp-edges;
        }

        /* ========== ãƒ“ãƒªãƒ¤ãƒ¼ãƒ‰ãƒ­ã‚´ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç”»é¢ ========== */
        .billiard-screen {
            background: linear-gradient(180deg, #1a1a1a 0%, #0d0d0d 100%);
        }
        .billiard-screen.active {
            display: flex;
        }
        .billiard-container {
            position: relative;
            width: 1920px;
            height: 1080px;
            overflow: hidden;
        }
        .billiard-ball {
            position: absolute;
            width: 150px;
            height: 150px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            background: transparent;
            border: none;
            font-size: 158px;
            font-weight: bold;
            color: #ffffff;
            transform: translate(-50%, -50%);
            font-family: 'Hiragino Kaku Gothic Pro', 'ãƒ¡ã‚¤ãƒªã‚ª', sans-serif;
        }
        .billiard-cue-ball {
            position: absolute;
            width: 100px;
            height: 100px;
            background: #ffffff;
            border-radius: 50%;
            box-shadow: 4px 4px 15px rgba(0,0,0,0.5);
            transform: translate(-50%, -50%);
        }
        .billiard-cue-stick {
            position: absolute;
            width: 400px;
            height: 16px;
            background: linear-gradient(90deg, #2a2a2a 0%, #4a4a4a 50%, #6a6a6a 100%);
            border-radius: 8px;
            transform-origin: right center;
            opacity: 0;
            box-shadow: 4px 4px 10px rgba(0,0,0,0.5);
        }
        .billiard-impact {
            position: absolute;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255,255,255,0.9) 0%, transparent 70%);
            opacity: 0;
            pointer-events: none;
        }
        .billiard-impact.show {
            animation: billiardImpactFlash 0.3s ease-out forwards;
        }
        @keyframes billiardImpactFlash {
            0% { opacity: 1; transform: scale(0.5); }
            100% { opacity: 0; transform: scale(2.5); }
        }
        .billiard-shine-line {
            position: absolute;
            top: 390px;
            left: -200px;
            width: 150px;
            height: 300px;
            background: linear-gradient(90deg, transparent 0%, rgba(255,255,255,0.1) 20%, rgba(255,255,255,0.8) 50%, rgba(255,255,255,0.1) 80%, transparent 100%);
            transform: skewX(-20deg);
            opacity: 0;
            pointer-events: none;
        }
        .billiard-shine-line.animate {
            animation: billiardShinePass 0.8s ease-in-out forwards;
        }
        @keyframes billiardShinePass {
            0% { left: 0px; opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { left: 1920px; opacity: 0; }
        }
        .billiard-sparkle {
            position: absolute;
            width: 50px;
            height: 50px;
            opacity: 0;
            pointer-events: none;
        }
        .billiard-sparkle::before,
        .billiard-sparkle::after {
            content: '';
            position: absolute;
            background: #ffffff;
        }
        .billiard-sparkle::before {
            top: 50%;
            left: 0;
            width: 100%;
            height: 4px;
            transform: translateY(-50%);
            border-radius: 2px;
        }
        .billiard-sparkle::after {
            left: 50%;
            top: 0;
            width: 4px;
            height: 100%;
            transform: translateX(-50%);
            border-radius: 2px;
        }
        .billiard-sparkle.animate {
            animation: billiardSparkleFlash 0.6s ease-out forwards;
        }
        @keyframes billiardSparkleFlash {
            0% { opacity: 0; transform: scale(0) rotate(0deg); }
            50% { opacity: 1; transform: scale(1.2) rotate(15deg); }
            100% { opacity: 0; transform: scale(0.5) rotate(30deg); }
        }
        .billiard-sparkle-small {
            width: 25px;
            height: 25px;
        }
        .billiard-sparkle-small::before { height: 2px; }
        .billiard-sparkle-small::after { width: 2px; }
    </style>
</head>
<body>
    <div class="container" id="main-container">
        <div class="table-container">
            <table>
            <thead>
                <tr class="header">
                    <th scope="col">èŠ±ç²‰å</th>
                    <th scope="col" id="month-1">1æœˆ</th><th scope="col" id="month-2">2æœˆ</th><th scope="col" id="month-3">3æœˆ</th><th scope="col" id="month-4">4æœˆ</th>
                    <th scope="col" id="month-5">5æœˆ</th><th scope="col" id="month-6">6æœˆ</th><th scope="col" id="month-7">7æœˆ</th><th scope="col" id="month-8">8æœˆ</th>
                    <th scope="col" id="month-9">9æœˆ</th><th scope="col" id="month-10">10æœˆ</th><th scope="col" id="month-11">11æœˆ</th><th scope="col" id="month-12">12æœˆ</th>
                </tr>
            </thead>
            <tbody id="pollen-table-body"></tbody>
        </table>
        </div>
        
        <div class="current-month-info" id="current-month-info" aria-live="polite">
            <div class="tips-info-card">
                <h3 class="tips-title">ğŸ¥ èŠ±ç²‰ç—‡å¯¾ç­–ã®ãƒã‚¤ãƒ³ãƒˆ</h3>
                <div class="tips-grid">
                    <div class="tip">
                        <strong>å¤–å‡ºæ™‚</strong>
                        <p>ãƒã‚¹ã‚¯ãƒ»ãƒ¡ã‚¬ãƒã‚’ç€ç”¨ã—ã¾ã—ã‚‡ã†</p>
                    </div>
                    <div class="tip">
                        <strong>å¸°å®…æ™‚</strong>
                        <p>ç„é–¢å‰ã§èŠ±ç²‰ã‚’æ‰•ã„ã€æ‰‹æ´—ã„ãƒ»ã†ãŒã„ã‚’</p>
                    </div>
                </div>
                <div class="bottom-area">
                    <p class="clinic-message">ç—‡çŠ¶ãŒè¾›ã„å ´åˆã¯ã€ãŠæ°—è»½ã«ã”ç›¸è«‡ãã ã•ã„</p>
                    <p class="source-citation-bottom">ã“ã®ã‚°ãƒ©ãƒ•ã¯ <strong>ç’°å¢ƒçœã®èŠ±ç²‰ç—‡ç’°å¢ƒä¿å¥ãƒãƒ‹ãƒ¥ã‚¢ãƒ«</strong> ã‹ã‚‰å¼•ç”¨ã—ã¾ã—ãŸ</p>
                </div>
            </div>
            <div class="pollen-info-card">
                <h2 id="current-month-title">ä»Šæœˆã®èŠ±ç²‰æƒ…å ±</h2>
                <div id="pollen-details"></div>
            </div>
        </div>
    </div>

    <div class="fullscreen-overlay pollen-alert-screen" id="pollen-alert-screen">
        <div class="pollen-alert-content">
            <div class="pollen-alert-icon" id="pollen-alert-icon">ğŸŒ¸</div>
            <div class="pollen-alert-month" id="pollen-alert-month"></div>
            <div class="pollen-alert-title">ã“ã®èŠ±ç²‰ã«ã”æ³¨æ„ãã ã•ã„</div>
            <div class="pollen-alert-list" id="pollen-alert-list"></div>
        </div>
    </div>

    <div class="fullscreen-overlay tips-screen" id="tips-screen">
        <div class="tips-fullscreen-content">
            <div class="tips-fullscreen-icon">ğŸ›¡ï¸</div>
            <div class="tips-fullscreen-title">èŠ±ç²‰ç—‡å¯¾ç­–ã®ãƒã‚¤ãƒ³ãƒˆ</div>
            <div class="tips-fullscreen-grid">
                <div class="tips-fullscreen-card">
                    <div class="tips-card-icon">ğŸš¶</div>
                    <div class="tips-card-content">
                        <div class="tips-card-title">å¤–å‡ºæ™‚</div>
                        <div class="tips-card-text">ãƒã‚¹ã‚¯ãƒ»ãƒ¡ã‚¬ãƒã‚’ç€ç”¨ã—ã¾ã—ã‚‡ã†</div>
                    </div>
                </div>
                <div class="tips-fullscreen-card">
                    <div class="tips-card-icon">ğŸ </div>
                    <div class="tips-card-content">
                        <div class="tips-card-title">å¸°å®…æ™‚</div>
                        <div class="tips-card-text">ç„é–¢å‰ã§èŠ±ç²‰ã‚’æ‰•ã„ã€æ‰‹æ´—ã„ãƒ»ã†ãŒã„ã‚’</div>
                    </div>
                </div>
                <div class="tips-fullscreen-card">
                    <div class="tips-card-icon">ğŸ§º</div>
                    <div class="tips-card-content">
                        <div class="tips-card-title">æ´—æ¿¯ç‰©</div>
                        <div class="tips-card-text">å®¤å†…å¹²ã—ã§èŠ±ç²‰ã®ä»˜ç€ã‚’é˜²æ­¢</div>
                    </div>
                </div>
            </div>
            <div class="tips-fullscreen-footer">
                <span class="tips-fullscreen-footer-icon">ğŸ’Š</span>
                ç—‡çŠ¶ãŒè¾›ã„å ´åˆã¯ã€ãŠæ°—è»½ã«ã”ç›¸è«‡ãã ã•ã„
            </div>
        </div>
    </div>

    <!-- ç”»åƒã‚¹ãƒ©ã‚¤ãƒ‰ã‚·ãƒ§ãƒ¼ç”»é¢ï¼ˆimages/config.jsonã‹ã‚‰å‹•çš„ã«èª­ã¿è¾¼ã¿ï¼‰ -->
    <div class="fullscreen-overlay slideshow-screen" id="slideshow-screen">
        <img src="" alt="ã‚¹ãƒ©ã‚¤ãƒ‰ã‚·ãƒ§ãƒ¼ç”»åƒ" class="slideshow-image" id="slideshow-image">
    </div>

    <!-- ãƒ“ãƒªãƒ¤ãƒ¼ãƒ‰ãƒ­ã‚´ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç”»é¢ -->
    <div class="fullscreen-overlay billiard-screen" id="billiard-screen">
        <div class="billiard-container">
            <div class="billiard-ball" id="billiard-ball-1">ãµ</div>
            <div class="billiard-ball" id="billiard-ball-2">ã˜</div>
            <div class="billiard-ball" id="billiard-ball-3">ã¿</div>
            <div class="billiard-ball" id="billiard-ball-4">é‡</div>
            <div class="billiard-ball" id="billiard-ball-5">ã²</div>
            <div class="billiard-ball" id="billiard-ball-6">ã‹</div>
            <div class="billiard-ball" id="billiard-ball-7">ã‚Š</div>
            <div class="billiard-ball" id="billiard-ball-8">çœ¼</div>
            <div class="billiard-ball" id="billiard-ball-9">ç§‘</div>
            <div class="billiard-cue-ball" id="billiard-cue-ball"></div>
            <div class="billiard-cue-stick" id="billiard-cue-stick"></div>
            <div class="billiard-impact" id="billiard-impact"></div>
            <div class="billiard-shine-line" id="billiard-shine-line"></div>
            <div class="billiard-sparkle" id="billiard-sparkle1"></div>
            <div class="billiard-sparkle billiard-sparkle-small" id="billiard-sparkle2"></div>
            <div class="billiard-sparkle billiard-sparkle-small" id="billiard-sparkle3"></div>
            <div class="billiard-sparkle" id="billiard-sparkle4"></div>
            <div class="billiard-sparkle billiard-sparkle-small" id="billiard-sparkle5"></div>
        </div>
    </div>

    <div class="fullscreen-overlay clock-screen" id="clock-screen">
        <div class="clock-content">
            <div class="clock-date-weekday-section">
                <div class="clock-date-section">
                    <div class="clock-date-display" id="clock-date-display"></div>
                </div>
                <div class="clock-weekday-section">
                    <div class="clock-weekday-ruby" id="clock-weekday-ruby"></div>
                    <div class="clock-weekday-main" id="clock-weekday-main"></div>
                </div>
            </div>
            <div class="clock-time-section">
                <div class="clock-time-display" id="clock-time-display"></div>
            </div>
        </div>
        <div class="clock-logo-section">
            <img src="ãµã˜ã¿é‡ã²ã‹ã‚Šçœ¼ç§‘_ãƒ­ã‚´_é«˜ç”»è³ª.png" alt="ãµã˜ã¿é‡ã²ã‹ã‚Šçœ¼ç§‘ãƒ­ã‚´">
        </div>
    </div>

    <!-- å¤©æ°—äºˆå ±ç”»é¢ -->
    <div class="fullscreen-overlay weather-screen" id="weather-screen">
        <div class="weather-content">
            <div class="weather-header">
                <div class="weather-location">ğŸŒ¤ï¸ ãµã˜ã¿é‡å¸‚ã®å¤©æ°—äºˆå ±</div>
                <div class="weather-update-time" id="weather-update-time"></div>
            </div>
            <div class="weather-cards" id="weather-cards">
                <div class="weather-loading">â˜ï¸ ãƒ‡ãƒ¼ã‚¿å–å¾—ä¸­...</div>
            </div>
            <div class="weather-source">å‡ºå…¸ï¼šæ°—è±¡åº</div>
        </div>
    </div>

    <div class="fullscreen-overlay logo-animation-screen" id="logo-animation-screen">
        <div class="logo-animation-container">
            <canvas id="particleCanvas"></canvas>
        </div>
    </div>

    <!-- ãƒ•ã‚¡ãƒŸã‚³ãƒ³é¢¨ãƒ­ã‚´ç”»é¢ -->
    <div class="fullscreen-overlay famicom-logo-screen" id="famicom-logo-screen">
        <div class="famicom-logo-container">
            <canvas id="famicomCanvas"></canvas>
        </div>
    </div>

    <script>
        // ==========================================
        //  è¨­å®šã‚¨ãƒªã‚¢ (ã“ã“ã‚’å¤‰æ›´ã™ã‚‹ã ã‘ã§èª¿æ•´å¯èƒ½)
        // ==========================================
        const CONFIG = {
            // ç”»é¢åˆ‡ã‚Šæ›¿ãˆæ™‚é–“ï¼ˆãƒŸãƒªç§’: 1000 = 1ç§’ï¼‰
            durations: {
                main: 30000,          // ãƒ¡ã‚¤ãƒ³ç”»é¢
                alert: 15000,         // èŠ±ç²‰æ³¨æ„ç”»é¢
                tips: 15000,          // å¯¾ç­–ãƒã‚¤ãƒ³ãƒˆ(ãƒ†ã‚­ã‚¹ãƒˆ)
                billiard: 30000,      // ãƒ“ãƒªãƒ¤ãƒ¼ãƒ‰ãƒ­ã‚´ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
                clock: 15000,         // æ™‚è¨ˆç”»é¢
                weather: 30000,       // å¤©æ°—äºˆå ±ç”»é¢
                weatherError: 3000,   // å¤©æ°—äºˆå ±ã‚¨ãƒ©ãƒ¼æ™‚
                logo: 15000,          // ãƒ­ã‚´ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ï¼‰
                famicom: 15000,       // ãƒ•ã‚¡ãƒŸã‚³ãƒ³é¢¨ãƒ­ã‚´
                slideshowDefault: 10000 // ã‚¹ãƒ©ã‚¤ãƒ‰ã‚·ãƒ§ãƒ¼ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¡¨ç¤ºæ™‚é–“
            },
            // ãƒ¬ãƒ™ãƒ«ã®é‡ã¿ä»˜ã‘ï¼ˆæ•°å€¤ãŒå¤§ãã„ã»ã©å„ªå…ˆè¡¨ç¤ºï¼‰
            levelOrder: { 'å¤šã„': 3, 'ã‚„ã‚„å¤šã„': 2, 'å°‘ãªã„': 1, '': 0 },
            // ã‚¹ãƒ©ã‚¤ãƒ‰ã‚·ãƒ§ãƒ¼è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹
            slideshowConfigPath: 'images/config.json'
        };

        // ==========================================
        //  èŠ±ç²‰ãƒ‡ãƒ¼ã‚¿ç®¡ç†ã‚¨ãƒªã‚¢
        // ==========================================
        const POLLEN_DATA = [
            {
                name: 'ãƒãƒ³ãƒã‚­å±',
                type: 'tree',
                schedule: { 1: 'å°‘ãªã„', 2: 'å°‘ãªã„', 3: 'å°‘ãªã„', 4: 'å°‘ãªã„', 5: 'å°‘ãªã„', 6: 'å°‘ãªã„' }
            },
            {
                name: 'ã‚¹ã‚®',
                type: 'tree',
                schedule: { 1: 'å°‘ãªã„', 2: 'ã‚„ã‚„å¤šã„', 3: 'å¤šã„', 4: 'å¤šã„', 5: 'å°‘ãªã„', 10: 'å°‘ãªã„', 11: 'å°‘ãªã„', 12: 'å°‘ãªã„' }
            },
            {
                name: 'ãƒ’ãƒã‚­',
                type: 'tree',
                schedule: { 2: 'å°‘ãªã„', 3: 'ã‚„ã‚„å¤šã„', 4: 'å¤šã„', 5: 'ã‚„ã‚„å¤šã„', 6: 'å°‘ãªã„' }
            },
            {
                name: 'ã‚¤ãƒç§‘',
                type: 'grass',
                schedule: { 4: 'å°‘ãªã„', 5: 'ã‚„ã‚„å¤šã„', 6: 'å¤šã„', 7: 'å°‘ãªã„', 8: 'å°‘ãªã„', 9: 'å°‘ãªã„', 10: 'å°‘ãªã„' }
            },
            {
                name: 'ãƒ–ã‚¿ã‚¯ã‚µå±',
                type: 'grass',
                schedule: { 8: 'ã‚„ã‚„å¤šã„', 9: 'å¤šã„', 10: 'å°‘ãªã„' }
            },
            {
                name: 'ãƒ¨ãƒ¢ã‚®å±',
                type: 'grass',
                schedule: { 8: 'å°‘ãªã„', 9: 'å°‘ãªã„', 10: 'å°‘ãªã„' }
            },
            {
                name: 'ã‚«ãƒŠãƒ ã‚°ãƒ©',
                type: 'grass',
                schedule: { 8: 'å°‘ãªã„', 9: 'ã‚„ã‚„å¤šã„', 10: 'ã‚„ã‚„å¤šã„', 11: 'å°‘ãªã„' }
            }
        ];

        document.addEventListener('DOMContentLoaded', () => {
            const currentMonth = new Date().getMonth() + 1;

            // èŠ±ç²‰ã”ã¨ã®ã‚¢ã‚¤ã‚³ãƒ³ãƒãƒƒãƒ”ãƒ³ã‚°
            const pollenIcons = {
                'ãƒãƒ³ãƒã‚­å±': 'ğŸŒ³', 'ã‚¹ã‚®': 'ğŸŒ²', 'ãƒ’ãƒã‚­': 'ğŸ„',
                'ã‚¤ãƒç§‘': 'ğŸŒ¾', 'ãƒ–ã‚¿ã‚¯ã‚µå±': 'ğŸŒ¿', 'ãƒ¨ãƒ¢ã‚®å±': 'ğŸƒ', 'ã‚«ãƒŠãƒ ã‚°ãƒ©': 'ğŸ€'
            };

            // æœˆã”ã¨ã®ã‚¢ã‚¤ã‚³ãƒ³ãƒãƒƒãƒ”ãƒ³ã‚°
            const monthIcons = {
                1: 'ğŸ', 2: 'ğŸ’', 3: 'ğŸŒ¸', 4: 'ğŸŒ·', 5: 'ğŸ', 6: 'â˜”',
                7: 'ğŸ‹', 8: 'ğŸŒ»', 9: 'ğŸ‘', 10: 'ğŸƒ', 11: 'ğŸ', 12: 'ğŸ„'
            };

            // ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
            function getLevelClass(level) {
                if (level === 'å¤šã„') return 'high';
                if (level === 'ã‚„ã‚„å¤šã„') return 'medium';
                if (level === 'å°‘ãªã„') return 'low';
                return '';
            }

            // ãƒ†ãƒ¼ãƒ–ãƒ«ã®è‡ªå‹•ç”Ÿæˆ
            function renderTable() {
                const tbody = document.getElementById('pollen-table-body');
                tbody.innerHTML = ''; // ã‚¯ãƒªã‚¢

                POLLEN_DATA.forEach(plant => {
                    const tr = document.createElement('tr');
                    
                    // æ¤ç‰©åã‚»ãƒ«
                    const nameTd = document.createElement('td');
                    nameTd.className = 'plant-name';
                    nameTd.scope = 'row';
                    nameTd.textContent = plant.name;
                    tr.appendChild(nameTd);

                    // 1æœˆã€œ12æœˆã®ã‚»ãƒ«
                    for (let m = 1; m <= 12; m++) {
                        const td = document.createElement('td');
                        td.dataset.month = m;
                        
                        const level = plant.schedule[m];
                        if (level) {
                            const levelClass = getLevelClass(level);
                            td.className = `${plant.type}-${levelClass}`; // ä¾‹: tree-high
                            td.dataset.pollen = plant.name;
                            td.dataset.level = level;
                        }
                        tr.appendChild(td);
                    }
                    tbody.appendChild(tr);
                });
            }

            // ä»Šæœˆã®èŠ±ç²‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ï¼ˆãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã‹ã‚‰ç›´æ¥å–å¾—ï¼‰
            function getCurrentMonthPollens() {
                const pollens = [];
                POLLEN_DATA.forEach(plant => {
                    const level = plant.schedule[currentMonth];
                    if (level) {
                        pollens.push({
                            name: plant.name,
                            level: level,
                            type: plant.type,
                            levelClass: getLevelClass(level),
                            icon: pollenIcons[plant.name] || 'ğŸŒ¼'
                        });
                    }
                });
                
                // ãƒ¬ãƒ™ãƒ«ãŒé«˜ã„é †ã«ã‚½ãƒ¼ãƒˆ
                pollens.sort((a, b) => (CONFIG.levelOrder[b.level] || 0) - (CONFIG.levelOrder[a.level] || 0));
                return pollens;
            }

            function highlightCurrentMonthColumn() {
                const header = document.getElementById(`month-${currentMonth}`);
                if (header) { header.classList.add('current-month-column'); }
                // ç”Ÿæˆã•ã‚ŒãŸã‚»ãƒ«ã«å¯¾ã—ã¦é©ç”¨
                document.querySelectorAll(`td[data-month="${currentMonth}"]`).forEach(cell => { 
                    cell.classList.add('current-month-column'); 
                });
            }

            function displayCurrentMonthInfo() {
                const pollens = getCurrentMonthPollens();
                const titleElement = document.getElementById('current-month-title');
                const detailsContainer = document.getElementById('pollen-details');
                const monthName = `${currentMonth}æœˆ`;
                detailsContainer.innerHTML = '';
                
                if (pollens.length === 0) {
                    titleElement.textContent = `ï¼${monthName}ã¯èŠ±ç²‰ã®å°‘ãªã„æ™‚æœŸã§ã™ï¼`;
                    const messageDiv = document.createElement('div');
                    messageDiv.className = 'info-message';
                    const p1 = document.createElement('p');
                    p1.textContent = 'ç¾åœ¨ã¯ä¸»è¦ãªèŠ±ç²‰ã®é£›æ•£æ™‚æœŸã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚';
                    const p2 = document.createElement('p');
                    p2.textContent = 'æ¯”è¼ƒçš„éã”ã—ã‚„ã™ã„æ™‚æœŸã§ã™ãŒã€ãŠå›°ã‚Šã®éš›ã¯ãŠå£°ãŒã‘ãã ã•ã„ã€‚';
                    messageDiv.append(p1, p2);
                    detailsContainer.appendChild(messageDiv);
                } else {
                    const mainPollen = pollens[0];
                    titleElement.textContent = `ï¼${monthName}ã¯ã€Œ${mainPollen.name}ã€ãªã©ã«æ³¨æ„ï¼`;
                    pollens.forEach(p => {
                        const itemDiv = document.createElement('div');
                        itemDiv.className = `pollen-item ${p.type}-${p.levelClass}`;
                        if (p.level === 'å¤šã„') {
                            itemDiv.classList.add('pollen-item-high-alert');
                        }
                        const nameSpan = document.createElement('span');
                        nameSpan.className = 'pollen-item-name';
                        nameSpan.textContent = p.name;
                        const levelSpan = document.createElement('span');
                        levelSpan.className = 'pollen-item-level';
                        levelSpan.textContent = `ã€${p.level}ã€‘`;
                        itemDiv.append(nameSpan, levelSpan);
                        detailsContainer.appendChild(itemDiv);
                    });
                }
            }

            // ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³èŠ±ç²‰ã‚¢ãƒ©ãƒ¼ãƒˆã‚’è¨­å®š
            function setupPollenAlertScreen() {
                const pollens = getCurrentMonthPollens();
                const monthIcon = document.getElementById('pollen-alert-icon');
                const monthTitle = document.getElementById('pollen-alert-month');
                const listContainer = document.getElementById('pollen-alert-list');

                // æœˆåˆ¥ã‚¢ã‚¤ã‚³ãƒ³ã‚’è¨­å®š
                monthIcon.textContent = monthIcons[currentMonth] || 'ğŸŒ¼';
                monthTitle.textContent = `${currentMonth}æœˆ`;
                listContainer.innerHTML = '';

                pollens.forEach(p => {
                    const item = document.createElement('div');
                    item.className = 'pollen-alert-item';
                    item.innerHTML = `
                        <div class="pollen-alert-item-icon">${p.icon}</div>
                        <div class="pollen-alert-item-info">
                            <div class="pollen-alert-item-name">${p.name}</div>
                            <div class="pollen-alert-item-level level-${p.levelClass}">${p.level}</div>
                        </div>
                    `;
                    listContainer.appendChild(item);
                });
            }

            // æ™‚è¨ˆè¡¨ç¤ºã®æ›´æ–°
            function updateClock() {
                const now = new Date();
                
                // æ™‚è¨ˆç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹æ™‚ã®ã¿DOMã‚’æ›´æ–°
                const clockScreen = document.getElementById('clock-screen');
                if (!clockScreen || !clockScreen.classList.contains('active')) {
                    return; // æ™‚è¨ˆç”»é¢ãŒéè¡¨ç¤ºãªã‚‰ä½•ã‚‚ã—ãªã„
                }
                
                // æ™‚é–“ã®æ›´æ–°
                const hours = now.getHours().toString().padStart(2, '0');
                const minutes = now.getMinutes().toString().padStart(2, '0');
                const seconds = now.getSeconds().toString().padStart(2, '0');
                
                document.getElementById('clock-time-display').innerHTML = 
                    `<span class="number">${hours}</span><ruby>æ™‚<rt>ã˜</rt></ruby>` +
                    `<span class="number">${minutes}</span><ruby>åˆ†<rt>ãµã‚“</rt></ruby>` +
                    `<span class="seconds-number">${seconds}</span><ruby class="seconds-kanji">ç§’<rt>ã³ã‚‡ã†</rt></ruby>`;
                
                // æ—¥ä»˜ã®æ›´æ–°
                const month = now.getMonth() + 1;
                const date = now.getDate();

                document.getElementById('clock-date-display').innerHTML = 
                    `<span class="number">${month}</span><ruby>æœˆ<rt>ãŒã¤</rt></ruby>` +
                    `<span class="number">${date}</span><ruby>æ—¥<rt>ã«ã¡</rt></ruby>`;

                // æ›œæ—¥ã®æ›´æ–°
                const weekdays = ['æ—¥æ›œæ—¥', 'æœˆæ›œæ—¥', 'ç«æ›œæ—¥', 'æ°´æ›œæ—¥', 'æœ¨æ›œæ—¥', 'é‡‘æ›œæ—¥', 'åœŸæ›œæ—¥'];
                const weekdayRuby = ['ã«ã¡ã‚ˆã†ã³', 'ã’ã¤ã‚ˆã†ã³', 'ã‹ã‚ˆã†ã³', 'ã™ã„ã‚ˆã†ã³', 'ã‚‚ãã‚ˆã†ã³', 'ãã‚“ã‚ˆã†ã³', 'ã©ã‚ˆã†ã³'];
                const dayOfWeek = now.getDay();
                
                document.getElementById('clock-weekday-main').textContent = weekdays[dayOfWeek];
                document.getElementById('clock-weekday-ruby').textContent = weekdayRuby[dayOfWeek];
            }

            // ç”»é¢åˆ‡ã‚Šæ›¿ãˆãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³
            let currentScreen = 0;
            let rotationTimeoutId = null;
            let weatherDataLoaded = false; // å¤©æ°—ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿çŠ¶æ…‹
            let slideshowImages = []; // ã‚¹ãƒ©ã‚¤ãƒ‰ã‚·ãƒ§ãƒ¼ç”»åƒãƒªã‚¹ãƒˆ

            // åŸºæœ¬ã®ç”»é¢ãƒªã‚¹ãƒˆï¼ˆã‚¹ãƒ©ã‚¤ãƒ‰ã‚·ãƒ§ãƒ¼ç”»åƒã¯å‹•çš„ã«è¿½åŠ ï¼‰
            const baseScreens = [
                { id: null, duration: CONFIG.durations.main },                    // ãƒ¡ã‚¤ãƒ³ç”»é¢
                { id: 'pollen-alert-screen', duration: CONFIG.durations.alert },  // èŠ±ç²‰ã‚¢ãƒ©ãƒ¼ãƒˆ
                { id: 'tips-screen', duration: CONFIG.durations.tips },           // å¯¾ç­–ãƒã‚¤ãƒ³ãƒˆ(ãƒ†ã‚­ã‚¹ãƒˆ)
            ];

            // å¾ŒåŠã®å›ºå®šç”»é¢
            const endScreens = [
                { id: 'billiard-screen', duration: CONFIG.durations.billiard },   // ãƒ“ãƒªãƒ¤ãƒ¼ãƒ‰ãƒ­ã‚´
                { id: 'clock-screen', duration: CONFIG.durations.clock },         // æ™‚è¨ˆè¡¨ç¤º
                { id: 'weather-screen', duration: CONFIG.durations.weather },     // å¤©æ°—äºˆå ±
                { id: 'logo-animation-screen', duration: CONFIG.durations.logo },  // ãƒ­ã‚´ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ï¼‰
                { id: 'famicom-logo-screen', duration: CONFIG.durations.famicom }  // ãƒ•ã‚¡ãƒŸã‚³ãƒ³é¢¨ãƒ­ã‚´
            ];

            // ã‚¹ãƒ©ã‚¤ãƒ‰ã‚·ãƒ§ãƒ¼ç”»åƒã‚’å«ã‚€å…¨ç”»é¢ãƒªã‚¹ãƒˆ
            let screens = [];

            // ãƒ•ã‚¡ã‚¤ãƒ«åã‹ã‚‰é †ç•ªã¨è¡¨ç¤ºç§’æ•°ã‚’è§£æ
            // å½¢å¼: {é †ç•ª}_{ç§’æ•°}_{èª¬æ˜}.{æ‹¡å¼µå­}  ä¾‹: 1_15_èŠ±ç²‰ç—‡å¯¾ç­–.png
            function parseImageFilename(filename) {
                const match = filename.match(/^(\d+)_(\d+)_(.+)\.(png|jpg|jpeg|gif|webp)$/i);
                if (match) {
                    return {
                        order: parseInt(match[1]),
                        duration: parseInt(match[2]) * 1000, // ç§’â†’ãƒŸãƒªç§’
                        description: match[3],
                        filename: filename
                    };
                }
                // å½¢å¼ãŒåˆã‚ãªã„å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤
                return {
                    order: 999,
                    duration: CONFIG.durations.slideshowDefault,
                    description: filename,
                    filename: filename
                };
            }

            // ã‚¹ãƒ©ã‚¤ãƒ‰ã‚·ãƒ§ãƒ¼è¨­å®šã‚’èª­ã¿è¾¼ã¿
            async function loadSlideshowConfig() {
                try {
                    const response = await fetch(CONFIG.slideshowConfigPath);
                    if (!response.ok) {
                        console.log('ã‚¹ãƒ©ã‚¤ãƒ‰ã‚·ãƒ§ãƒ¼è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                        return [];
                    }
                    const config = await response.json();
                    if (config.images && Array.isArray(config.images)) {
                        // ç”»åƒæƒ…å ±ã‚’è§£æã—ã¦ã‚½ãƒ¼ãƒˆ
                        const parsed = config.images
                            .map(filename => parseImageFilename(filename))
                            .sort((a, b) => a.order - b.order);
                        console.log('ã‚¹ãƒ©ã‚¤ãƒ‰ã‚·ãƒ§ãƒ¼ç”»åƒ:', parsed);
                        return parsed;
                    }
                } catch (error) {
                    console.log('ã‚¹ãƒ©ã‚¤ãƒ‰ã‚·ãƒ§ãƒ¼è¨­å®šèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
                }
                return [];
            }

            // ç”»é¢ãƒªã‚¹ãƒˆã‚’æ§‹ç¯‰
            async function buildScreensList() {
                slideshowImages = await loadSlideshowConfig();

                // ã‚¹ãƒ©ã‚¤ãƒ‰ã‚·ãƒ§ãƒ¼ç”»åƒã‚’ç”»é¢ãƒªã‚¹ãƒˆã«å¤‰æ›
                const slideshowScreens = slideshowImages.map(img => ({
                    id: 'slideshow-screen',
                    duration: img.duration,
                    slideshowImage: 'images/' + img.filename
                }));

                // ç”»é¢ãƒªã‚¹ãƒˆã‚’æ§‹ç¯‰: åŸºæœ¬ç”»é¢ + ã‚¹ãƒ©ã‚¤ãƒ‰ã‚·ãƒ§ãƒ¼ + å¾ŒåŠç”»é¢
                screens = [...baseScreens, ...slideshowScreens, ...endScreens];
                console.log('ç”»é¢ãƒªã‚¹ãƒˆæ§‹ç¯‰å®Œäº†:', screens.length, 'ç”»é¢');
            }

            function showScreen(index) {
                // ã™ã¹ã¦ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã‚’éè¡¨ç¤º
                document.querySelectorAll('.fullscreen-overlay').forEach(el => {
                    el.classList.remove('active');
                });

                // æŒ‡å®šã•ã‚ŒãŸç”»é¢ã‚’è¡¨ç¤º
                if (screens[index].id) {
                    document.getElementById(screens[index].id).classList.add('active');

                    // ã‚¹ãƒ©ã‚¤ãƒ‰ã‚·ãƒ§ãƒ¼ç”»é¢ã®å ´åˆã¯ç”»åƒã‚’è¨­å®š
                    if (screens[index].id === 'slideshow-screen' && screens[index].slideshowImage) {
                        const imgEl = document.getElementById('slideshow-image');
                        imgEl.src = screens[index].slideshowImage;
                        imgEl.alt = screens[index].slideshowImage;
                        stopParticleAnimation();
                        stopBilliardAnimation();
                        stopFamicomAnimation();
                    } else if (screens[index].id === 'logo-animation-screen') {
                        // ãƒ­ã‚´ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç”»é¢
                        startParticleAnimation();
                        stopBilliardAnimation();
                        stopFamicomAnimation();
                    } else if (screens[index].id === 'billiard-screen') {
                        // ãƒ“ãƒªãƒ¤ãƒ¼ãƒ‰ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç”»é¢
                        stopParticleAnimation();
                        startBilliardAnimation();
                        stopFamicomAnimation();
                    } else if (screens[index].id === 'famicom-logo-screen') {
                        // ãƒ•ã‚¡ãƒŸã‚³ãƒ³é¢¨ãƒ­ã‚´ç”»é¢
                        stopParticleAnimation();
                        stopBilliardAnimation();
                        startFamicomAnimation();
                    } else if (screens[index].id === 'weather-screen') {
                        // å¤©æ°—äºˆå ±ç”»é¢
                        stopParticleAnimation();
                        stopBilliardAnimation();
                        stopFamicomAnimation();
                        updateWeatherScreenBackground(); // æ™‚é–“å¸¯ã«å¿œã˜ãŸèƒŒæ™¯ã«å¤‰æ›´
                        fetchWeatherData();
                    } else {
                        // ãã®ä»–ã®ç”»é¢ã§ã¯ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’åœæ­¢
                        stopParticleAnimation();
                        stopBilliardAnimation();
                        stopFamicomAnimation();
                    }
                } else {
                    // ãƒ¡ã‚¤ãƒ³ç”»é¢ã®å ´åˆã‚‚ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’åœæ­¢
                    stopParticleAnimation();
                    stopBilliardAnimation();
                    stopFamicomAnimation();
                }
            }

            function rotateScreens() {
                showScreen(currentScreen);
                
                // å¤©æ°—äºˆå ±ç”»é¢ã§ãƒ‡ãƒ¼ã‚¿æœªå–å¾—ã®å ´åˆã¯3ç§’ã§æ¬¡ã¸
                let duration = screens[currentScreen].duration;
                if (screens[currentScreen].id === 'weather-screen' && !weatherDataLoaded) {
                    duration = CONFIG.durations.weatherError;
                }
                
                rotationTimeoutId = setTimeout(() => {
                    currentScreen = (currentScreen + 1) % screens.length;
                    
                    // ãƒ­ã‚´ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³(æœ€å¾Œã®ç”»é¢)ãŒçµ‚ã‚ã£ãŸã‚‰ã€ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ­ãƒ¼ãƒ‰
                    if (currentScreen === 0) {
                        location.reload();
                        return; // ãƒªãƒ­ãƒ¼ãƒ‰å¾Œã¯å‡¦ç†ã‚’ç¶šã‘ãªã„
                    }
                    
                    rotateScreens();
                }, duration);
            }

            // ã‚¹ãƒšãƒ¼ã‚¹ã‚­ãƒ¼ã§æ¬¡ã®ç”»é¢ã«åˆ‡ã‚Šæ›¿ãˆ
            function goToNextScreen() {
                // ç¾åœ¨ã®ã‚¿ã‚¤ãƒãƒ¼ã‚’ã‚¯ãƒªã‚¢
                if (rotationTimeoutId) {
                    clearTimeout(rotationTimeoutId);
                }
                // æ¬¡ã®ç”»é¢ã¸
                currentScreen = (currentScreen + 1) % screens.length;
                // ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å†é–‹
                rotateScreens();
            }

            // ã‚¹ãƒšãƒ¼ã‚¹ã‚­ãƒ¼ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
            document.addEventListener('keydown', (e) => {
                if (e.code === 'Space') {
                    e.preventDefault(); // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é˜²æ­¢
                    goToNextScreen();
                }
            });

            // ========== ãƒ“ãƒªãƒ¤ãƒ¼ãƒ‰ãƒ­ã‚´ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ ==========
            const billiardBalls = [];
            const billiardCueBall = document.getElementById('billiard-cue-ball');
            const billiardCueStick = document.getElementById('billiard-cue-stick');
            const billiardImpact = document.getElementById('billiard-impact');
            const billiardShineLine = document.getElementById('billiard-shine-line');
            const billiardSparkles = [
                document.getElementById('billiard-sparkle1'),
                document.getElementById('billiard-sparkle2'),
                document.getElementById('billiard-sparkle3'),
                document.getElementById('billiard-sparkle4'),
                document.getElementById('billiard-sparkle5')
            ];
            
            const billiardTableWidth = 1920;
            const billiardTableHeight = 1080;
            const billiardPadding = 80;
            
            // ãƒŠã‚¤ãƒ³ãƒœãƒ¼ãƒ«ã®ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰é…ç½®ï¼ˆç‰©ç†çš„ãªä½ç½®ï¼‰
            const billiardRackSlots = [
                { x: 1050, y: 540 },
                { x: 1200, y: 440 },
                { x: 1200, y: 640 },
                { x: 1350, y: 340 },
                { x: 1350, y: 540 },
                { x: 1350, y: 740 },
                { x: 1500, y: 440 },
                { x: 1500, y: 640 },
                { x: 1650, y: 540 },
            ];
            
            // ã‚·ãƒ£ãƒƒãƒ•ãƒ«ãƒãƒƒãƒ—
            const billiardShuffleMap = [2, 7, 5, 6, 0, 3, 8, 1, 4];
            
            // æ‰‹ç‰ã®ä½ç½®
            const billiardCueBallStart = { x: 300, y: 540 };
            const billiardCueBallImpactPos = { x: 950, y: 540 };
            
            // æ¨ªä¸€åˆ—ã®ä½ç½®ï¼ˆå¥‡æ•°å›ç›®ç”¨ï¼‰
            const billiardLinePositions = [];
            const billiardLineStartX = 160;
            const billiardLineSpacing = 190;
            for (let i = 0; i < 9; i++) {
                billiardLinePositions.push({ x: billiardLineStartX + i * billiardLineSpacing, y: 540 });
            }
            
            // 3è¡Œé…ç½®ã®ä½ç½®ï¼ˆå¶æ•°å›ç›®ç”¨ï¼‰
            const billiardMultiLinePositions = [
                { x: 660, y: 340 }, { x: 850, y: 340 }, { x: 1040, y: 340 }, { x: 1230, y: 340 },
                { x: 755, y: 540 }, { x: 945, y: 540 }, { x: 1135, y: 540 },
                { x: 850, y: 740 }, { x: 1040, y: 740 },
            ];
            
            let billiardCurrentFinalPositions = billiardLinePositions;
            let billiardIsLinePattern = false;
            let billiardBallPaths = [];
            let billiardAnimationPhase = 'init';
            let billiardPhaseStartTime = 0;
            let billiardAnimationId = null;
            let billiardStartTime = 0;
            let billiardShineTriggered = false;
            let isBilliardAnimating = false;
            
            function billiardGenerateReflectionPath(startPos, endPos, reflections) {
                const path = [{ x: startPos.x, y: startPos.y }];
                for (let i = 0; i < reflections; i++) {
                    let nextX, nextY;
                    const wallChoice = Math.floor(Math.random() * 4);
                    switch (wallChoice) {
                        case 0: nextX = billiardPadding + Math.random() * (billiardTableWidth - billiardPadding * 2); nextY = billiardPadding; break;
                        case 1: nextX = billiardPadding + Math.random() * (billiardTableWidth - billiardPadding * 2); nextY = billiardTableHeight - billiardPadding; break;
                        case 2: nextX = billiardPadding; nextY = billiardPadding + Math.random() * (billiardTableHeight - billiardPadding * 2); break;
                        case 3: nextX = billiardTableWidth - billiardPadding; nextY = billiardPadding + Math.random() * (billiardTableHeight - billiardPadding * 2); break;
                    }
                    path.push({ x: nextX, y: nextY });
                }
                path.push({ x: endPos.x, y: endPos.y });
                return path;
            }
            
            function billiardGenerateAllPaths() {
                billiardBallPaths = [];
                for (let i = 0; i < 9; i++) {
                    const startSlot = billiardShuffleMap[i];
                    const startPos = billiardRackSlots[startSlot];
                    const endPos = billiardCurrentFinalPositions[i];
                    const reflections = 2 + Math.floor(Math.random() * 3);
                    const path = billiardGenerateReflectionPath(startPos, endPos, reflections);
                    billiardBallPaths.push(path);
                }
            }
            
            function billiardGetPositionOnPath(path, progress) {
                if (progress <= 0) return path[0];
                if (progress >= 1) return path[path.length - 1];
                const segments = [];
                let totalLength = 0;
                for (let i = 0; i < path.length - 1; i++) {
                    const dx = path[i + 1].x - path[i].x;
                    const dy = path[i + 1].y - path[i].y;
                    const length = Math.sqrt(dx * dx + dy * dy);
                    segments.push(length);
                    totalLength += length;
                }
                const targetLength = progress * totalLength;
                let currentLength = 0;
                for (let i = 0; i < segments.length; i++) {
                    if (currentLength + segments[i] >= targetLength) {
                        const segmentProgress = (targetLength - currentLength) / segments[i];
                        return {
                            x: path[i].x + (path[i + 1].x - path[i].x) * segmentProgress,
                            y: path[i].y + (path[i + 1].y - path[i].y) * segmentProgress
                        };
                    }
                    currentLength += segments[i];
                }
                return path[path.length - 1];
            }
            
            function billiardTriggerShineEffect() {
                if (billiardIsLinePattern) {
                    billiardShineLine.style.top = '390px';
                    billiardShineLine.style.height = '300px';
                } else {
                    billiardShineLine.style.top = '240px';
                    billiardShineLine.style.height = '600px';
                }
                billiardShineLine.classList.add('animate');
                
                let sparklePositions;
                if (billiardIsLinePattern) {
                    sparklePositions = [
                        { x: 250, y: 450, delay: 100 }, { x: 550, y: 500, delay: 200 },
                        { x: 900, y: 440, delay: 150 }, { x: 1300, y: 490, delay: 250 }, { x: 1650, y: 460, delay: 300 }
                    ];
                } else {
                    sparklePositions = [
                        { x: 750, y: 280, delay: 100 }, { x: 1140, y: 280, delay: 180 },
                        { x: 850, y: 480, delay: 250 }, { x: 750, y: 680, delay: 320 }, { x: 1140, y: 680, delay: 400 }
                    ];
                }
                billiardSparkles.forEach((sparkle, i) => {
                    sparkle.style.left = `${sparklePositions[i].x}px`;
                    sparkle.style.top = `${sparklePositions[i].y}px`;
                    setTimeout(() => { sparkle.classList.add('animate'); }, sparklePositions[i].delay);
                });
            }
            
            function billiardResetShineEffect() {
                billiardShineLine.classList.remove('animate');
                billiardSparkles.forEach(sparkle => { sparkle.classList.remove('animate'); });
                billiardShineTriggered = false;
            }
            
            function billiardEaseOutCubic(t) {
                return 1 - Math.pow(1 - t, 3);
            }
            
            function initBilliardBalls() {
                billiardBalls.length = 0;
                for (let i = 1; i <= 9; i++) {
                    billiardBalls.push(document.getElementById(`billiard-ball-${i}`));
                }
            }
            
            function resetBilliardAnimation() {
                if (billiardAnimationId) {
                    cancelAnimationFrame(billiardAnimationId);
                }
                
                billiardIsLinePattern = !billiardIsLinePattern;
                billiardCurrentFinalPositions = billiardIsLinePattern ? billiardLinePositions : billiardMultiLinePositions;
                
                billiardGenerateAllPaths();
                
                billiardBalls.forEach((ball, i) => {
                    const startSlot = billiardShuffleMap[i];
                    ball.style.left = `${billiardRackSlots[startSlot].x}px`;
                    ball.style.top = `${billiardRackSlots[startSlot].y}px`;
                    ball.style.opacity = '1';
                });
                
                billiardCueBall.style.left = `${billiardCueBallStart.x}px`;
                billiardCueBall.style.top = `${billiardCueBallStart.y}px`;
                billiardCueBall.style.opacity = '1';
                billiardCueStick.style.opacity = '0';
                billiardImpact.classList.remove('show');
                billiardResetShineEffect();
                
                billiardAnimationPhase = 'init';
                billiardStartTime = performance.now();
                billiardPhaseStartTime = billiardStartTime;
            }
            
            function animateBilliard() {
                if (!isBilliardAnimating) return;
                
                const now = performance.now();
                const elapsed = (now - billiardStartTime) / 1000;
                const phaseElapsed = (now - billiardPhaseStartTime) / 1000;
                
                if (elapsed >= 15) {
                    resetBilliardAnimation();
                    animateBilliard();
                    return;
                }
                
                if (elapsed >= 12.5 && !billiardShineTriggered) {
                    billiardTriggerShineEffect();
                    billiardShineTriggered = true;
                }
                
                switch (billiardAnimationPhase) {
                    case 'init':
                        if (phaseElapsed > 2) {
                            billiardCueStick.style.opacity = '1';
                            billiardCueStick.style.left = '-250px';
                            billiardCueStick.style.top = '532px';
                            const pullProgress = Math.min((phaseElapsed - 2) / 1, 1);
                            billiardCueStick.style.left = `${-250 - pullProgress * 100}px`;
                        }
                        if (phaseElapsed >= 3) {
                            billiardAnimationPhase = 'break';
                            billiardPhaseStartTime = now;
                        }
                        break;
                        
                    case 'break':
                        const breakProgress = Math.min(phaseElapsed / 0.2, 1);
                        billiardCueStick.style.left = `${-350 + breakProgress * 250}px`;
                        if (breakProgress >= 0.5) billiardCueStick.style.opacity = '0';
                        
                        const cueBallX = billiardCueBallStart.x + breakProgress * (billiardCueBallImpactPos.x - billiardCueBallStart.x);
                        billiardCueBall.style.left = `${cueBallX}px`;
                        
                        if (cueBallX >= billiardCueBallImpactPos.x - 50 && !billiardImpact.classList.contains('show')) {
                            billiardImpact.style.left = `${billiardCueBallImpactPos.x}px`;
                            billiardImpact.style.top = `${billiardCueBallImpactPos.y}px`;
                            billiardImpact.classList.add('show');
                            billiardCueBall.style.opacity = '0';
                            billiardAnimationPhase = 'reflect';
                            billiardPhaseStartTime = now;
                        }
                        break;
                        
                    case 'reflect':
                        const reflectProgress = Math.min(phaseElapsed / 8, 1);
                        billiardBalls.forEach((ball, i) => {
                            const speedVariation = 0.9 + (i % 3) * 0.05;
                            const adjustedProgress = Math.min(reflectProgress * speedVariation, 1);
                            const easedProgress = billiardEaseOutCubic(adjustedProgress);
                            const pos = billiardGetPositionOnPath(billiardBallPaths[i], easedProgress);
                            ball.style.left = `${pos.x}px`;
                            ball.style.top = `${pos.y}px`;
                        });
                        
                        if (reflectProgress >= 1) {
                            billiardAnimationPhase = 'hold';
                            billiardPhaseStartTime = now;
                            billiardBalls.forEach((ball, i) => {
                                ball.style.left = `${billiardCurrentFinalPositions[i].x}px`;
                                ball.style.top = `${billiardCurrentFinalPositions[i].y}px`;
                            });
                        }
                        break;
                        
                    case 'hold':
                        if (elapsed >= 14) {
                            billiardAnimationPhase = 'fadeOut';
                            billiardPhaseStartTime = now;
                        }
                        break;
                        
                    case 'fadeOut':
                        const fadeProgress = Math.min(phaseElapsed / 1, 1);
                        billiardBalls.forEach(ball => { ball.style.opacity = 1 - fadeProgress; });
                        if (fadeProgress >= 1) billiardAnimationPhase = 'done';
                        break;
                        
                    case 'done':
                        break;
                }
                
                billiardAnimationId = requestAnimationFrame(animateBilliard);
            }
            
            function startBilliardAnimation() {
                if (isBilliardAnimating) return;
                isBilliardAnimating = true;
                initBilliardBalls();
                resetBilliardAnimation();
                animateBilliard();
            }
            
            function stopBilliardAnimation() {
                if (billiardAnimationId) {
                    cancelAnimationFrame(billiardAnimationId);
                    billiardAnimationId = null;
                }
                isBilliardAnimating = false;
            }

            // ========== ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ãƒ­ã‚´ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ (çœç•¥: å‰å›ã®ã‚³ãƒ¼ãƒ‰ã¨åŒã˜) ==========
            const textPixelData = [
                [20,[[20,28],[39,41],[50,53],[59,67],[79,87],[90,98]]],
                [21,[[20,28],[39,41],[50,53],[59,67],[79,87],[90,98]]],
                [22,[[20,28],[39,41],[48,48],[52,54],[59,68],[79,79],[83,84],[87,88],[96,98]]],
                [23,[[25,28],[39,41],[48,48],[52,54],[65,67],[79,79],[83,84],[87,88],[96,98]]],
                [24,[[26,28],[39,41],[50,51],[65,67],[72,73],[79,88],[91,92],[95,97]]],
                [25,[[23,26],[39,41],[50,51],[65,67],[72,73],[79,88],[91,92],[94,97]]],
                [26,[[23,26],[39,41],[65,67],[72,73],[79,80],[83,84],[87,88],[93,95]]],
                [27,[[23,24],[39,41],[65,67],[72,73],[79,79],[83,84],[87,88],[93,96]]],
                [28,[[23,24],[39,41],[61,73],[79,80],[83,84],[86,88],[90,99]]],
                [29,[[17,19],[23,26],[31,32],[39,41],[59,73],[79,88],[90,99]]],
                [30,[[17,19],[23,26],[31,32],[39,41],[59,74],[82,84],[92,94],[97,99]]],
                [31,[[17,19],[24,28],[31,34],[39,41],[51,53],[57,60],[64,66],[71,75],[83,84],[93,94],[97,99]]],
                [32,[[16,19],[25,28],[32,34],[39,41],[51,53],[57,60],[64,66],[72,75],[79,87],[93,94],[97,98]]],
                [33,[[15,19],[26,28],[32,34],[39,41],[51,53],[57,59],[64,65],[72,75],[79,87],[93,94],[97,98]]],
                [34,[[15,18],[26,28],[32,34],[39,41],[49,53],[57,59],[62,65],[70,73],[79,86],[93,94]]],
                [35,[[15,18],[26,28],[32,34],[39,43],[49,53],[57,59],[62,65],[70,72],[83,84],[93,94]]],
                [36,[[15,18],[20,28],[32,34],[40,51],[59,65],[68,72],[83,84],[93,94]]],
                [37,[[20,26],[40,51],[59,63],[67,72],[78,87],[92,94]]],
                [38,[[20,26],[42,49],[59,63],[67,70],[78,87],[90,94]]],
                [39,[[90,94]]],
                [45,[[50,53],[74,77]]],
                [46,[[17,24],[29,32],[50,53],[74,77],[85,91]]],
                [47,[[17,24],[29,32],[50,53],[74,77],[85,91]]],
                [48,[[17,24],[30,32],[50,53],[63,65],[74,77],[85,91]]],
                [49,[[17,24],[30,35],[45,53],[63,65],[74,77],[85,91]]],
                [50,[[21,23],[30,35],[44,59],[63,66],[74,77],[89,91]]],
                [51,[[20,23],[32,37],[44,60],[64,66],[74,77],[89,92]]],
                [52,[[19,22],[32,38],[44,60],[64,67],[74,77],[89,93]]],
                [53,[[19,22],[32,38],[49,52],[58,60],[64,67],[74,77],[89,93]]],
                [54,[[18,20],[32,38],[49,52],[58,60],[64,67],[74,77],[80,81],[89,93]]],
                [55,[[17,20],[32,34],[37,38],[49,52],[58,60],[65,69],[74,77],[80,81],[89,93]]],
                [56,[[17,20],[32,34],[37,38],[48,51],[58,60],[66,69],[74,81],[89,93]]],
                [57,[[17,20],[32,34],[48,50],[58,60],[66,69],[74,81],[89,93]]],
                [58,[[17,20],[32,34],[48,50],[58,60],[66,69],[74,79],[89,93]]],
                [59,[[17,20],[32,34],[47,50],[58,60],[89,93]]],
                [60,[[17,20],[31,34],[47,50],[58,60],[87,91]]],
                [61,[[17,21],[31,34],[46,49],[57,60],[87,91]]],
                [62,[[17,22],[29,34],[45,49],[56,60],[84,90]]],
                [63,[[19,33],[45,48],[52,59],[78,90]]],
                [64,[[19,32],[44,48],[52,59],[78,90]]],
                [65,[[21,31],[44,47],[52,59],[78,88]]],
                [66,[[21,30],[44,46],[52,57],[78,85]]],
                [71,[[66,69],[81,83]]],
                [72,[[29,38],[41,53],[59,69],[81,83]]],
                [73,[[29,38],[41,53],[59,69],[73,77],[81,83]]],
                [74,[[29,38],[41,43],[51,53],[59,69],[73,77],[81,83]]],
                [75,[[29,31],[36,38],[41,43],[51,53],[63,66],[73,78],[81,83]]],
                [76,[[29,31],[36,38],[41,43],[51,53],[64,66],[75,78],[81,83]]],
                [77,[[29,31],[36,38],[41,53],[64,66],[76,78],[81,83]]],
                [78,[[29,38],[41,53],[59,70],[81,83]]],
                [79,[[29,38],[41,43],[51,53],[59,70],[72,75],[81,83]]],
                [80,[[29,38],[41,43],[51,53],[59,70],[72,76],[81,83]]],
                [81,[[29,31],[36,38],[41,43],[51,53],[64,66],[72,77],[81,83]]],
                [82,[[29,31],[36,38],[41,53],[64,67],[74,77],[81,83]]],
                [83,[[29,31],[36,38],[41,53],[63,68],[81,83]]],
                [84,[[29,38],[41,43],[45,49],[52,53],[61,70],[81,85]]],
                [85,[[29,38],[41,42],[46,48],[52,53],[61,70],[81,86]]],
                [86,[[29,38],[41,42],[46,48],[51,54],[60,70],[72,86]]],
                [87,[[29,31],[36,38],[41,42],[47,54],[59,66],[69,70],[72,86]]],
                [88,[[29,31],[36,38],[41,42],[47,53],[59,62],[64,66],[72,83]]],
                [89,[[29,31],[36,38],[41,42],[47,51],[59,61],[64,66],[81,83]]],
                [90,[[29,31],[35,38],[41,42],[48,51],[59,60],[64,66],[81,83]]],
                [91,[[29,38],[41,43],[45,47],[49,52],[64,66],[81,83]]],
                [92,[[29,38],[40,47],[49,54],[64,66],[81,83]]],
                [93,[[29,38],[40,47],[51,54],[64,66],[81,83]]],
                [94,[[40,45],[51,54],[64,66],[81,83]]]
            ];

            const particleCanvas = document.getElementById('particleCanvas');
            const particleCtx = particleCanvas.getContext('2d');
            
            particleCanvas.width = 1200;
            particleCanvas.height = 1200;
            
            const scale = 1200 / 1024;
            const blockSize = 9 * scale;
            
            // æ–‡å­—åº§æ¨™ã‚’å–å¾—
            const targetPositions = [];
            textPixelData.forEach(([gridY, segments]) => {
                segments.forEach(([startGridX, endGridX]) => {
                    for (let gridX = startGridX; gridX <= endGridX; gridX++) {
                        if ((gridX + gridY) % 3 === 0) {
                            targetPositions.push({
                                x: gridX * blockSize + blockSize / 2,
                                y: gridY * blockSize + blockSize / 2
                            });
                        }
                    }
                });
            });
            
            const LOOP_DURATION = 15000;
            
            // ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥
            const gradientCache = {};
            function getGradient(size, alpha) {
                const key = `${size}_${Math.round(alpha * 10)}`;
                if (!gradientCache[key]) {
                    const grad = particleCtx.createRadialGradient(0, 0, 0, 0, 0, size * 3);
                    grad.addColorStop(0, `rgba(255, 230, 150, ${alpha})`);
                    grad.addColorStop(0.3, `rgba(255, 200, 100, ${alpha * 0.9})`);
                    grad.addColorStop(0.6, `rgba(255, 170, 50, ${alpha * 0.6})`);
                    grad.addColorStop(1, 'rgba(255, 140, 0, 0)');
                    gradientCache[key] = grad;
                }
                return gradientCache[key];
            }
            
            // ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã‚¯ãƒ©ã‚¹
            class Particle {
                constructor(targetX, targetY, index) {
                    this.index = index;
                    this.targetX = targetX;
                    this.targetY = targetY;
                    this.reset();
                }
                
                reset() {
                    this.startX = Math.random() * particleCanvas.width;
                    this.startY = Math.random() * particleCanvas.height;
                    this.x = this.startX;
                    this.y = this.startY;
                    
                    this.vx = (Math.random() - 0.5) * 0.6;
                    this.vy = (Math.random() - 0.5) * 0.6;
                    this.floatOffset = Math.random() * Math.PI * 2;
                    
                    this.size = Math.random() * 1.5 + 2;
                    this.dynamicSize = this.size;
                    this.alpha = 0;
                    this.brightness = 0;
                    
                    this.flickerSpeed = Math.random() * 0.003 + 0.002;
                    this.flickerOffset = Math.random() * Math.PI * 2;
                    
                    this.appearDelay = this.index * 3;
                    this.gatherDelay = Math.random() * 1200;
                    this.angle = Math.atan2(this.startY - this.targetY, this.startX - this.targetX);
                }
                
                update(elapsed) {
                    this.brightness = 0.8 + Math.sin(elapsed * this.flickerSpeed + this.flickerOffset) * 0.2;
                    
                    if (elapsed < 3000) {
                        if (elapsed > this.appearDelay) {
                            this.alpha = Math.min(1, (elapsed - this.appearDelay) / 800);
                        }
                        this.x += this.vx + Math.sin(elapsed * 0.001 + this.floatOffset) * 0.3;
                        this.y += this.vy + Math.cos(elapsed * 0.001 + this.floatOffset) * 0.3;
                        
                        if (this.x < 0 || this.x > particleCanvas.width) this.vx *= -1;
                        if (this.y < 0 || this.y > particleCanvas.height) this.vy *= -1;
                        
                    } else if (elapsed < 8000) {
                        const t = elapsed - 3000;
                        if (t >= this.gatherDelay) {
                            const p = Math.min(1, (t - this.gatherDelay) / (5000 - this.gatherDelay));
                            const eased = 1 - Math.pow(1 - p, 3);
                            this.x += (this.targetX - this.x) * eased * 0.12;
                            this.y += (this.targetY - this.y) * eased * 0.12;
                            this.dynamicSize = this.size * (1 + eased * 2);
                        } else {
                            this.x += this.vx * 0.5;
                            this.y += this.vy * 0.5;
                            this.dynamicSize = this.size;
                        }
                        this.alpha = 1;
                        
                    } else if (elapsed < 12000) {
                        const wobble = Math.sin(elapsed * 0.002 + this.floatOffset) * 0.8;
                        this.x = this.targetX + wobble;
                        this.y = this.targetY + Math.cos(elapsed * 0.0025 + this.floatOffset) * 0.8;
                        this.dynamicSize = this.size * 3;
                        this.alpha = 1;
                        
                    } else {
                        const p = (elapsed - 12000) / 3000;
                        const eased = p * p;
                        const distance = 500 * eased;
                        this.x = this.targetX + Math.cos(this.angle) * distance;
                        this.y = this.targetY + Math.sin(this.angle) * distance;
                        this.dynamicSize = this.size * (3 - 2 * eased);
                        this.alpha = 1 - eased;
                    }
                }
                
                draw(ctx) {
                    if (this.alpha <= 0.05) return;
                    
                    const finalAlpha = this.alpha * this.brightness;
                    
                    ctx.save();
                    ctx.translate(this.x, this.y);
                    
                    ctx.fillStyle = getGradient(this.dynamicSize, finalAlpha);
                    ctx.fillRect(-this.dynamicSize * 3, -this.dynamicSize * 3, this.dynamicSize * 6, this.dynamicSize * 6);
                    
                    ctx.globalAlpha = finalAlpha;
                    ctx.fillStyle = 'rgb(255, 240, 200)';
                    ctx.beginPath();
                    ctx.arc(0, 0, this.dynamicSize * 0.6, 0, 6.28);
                    ctx.fill();
                    
                    ctx.restore();
                }
            }
            
            // ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã‚’ç”Ÿæˆ
            const particles = targetPositions.map((pos, i) => new Particle(pos.x, pos.y, i));
            
            let particleStartTime = null;
            let particleAnimationId = null;
            let isParticleAnimating = false;
            
            function resetParticleAnimation() {
                particleStartTime = Date.now();
                particles.forEach(p => p.reset());
            }
            
            function startParticleAnimation() {
                if (isParticleAnimating) return; // æ—¢ã«å®Ÿè¡Œä¸­ãªã‚‰ä½•ã‚‚ã—ãªã„
                isParticleAnimating = true;
                resetParticleAnimation();
                animateParticles();
            }
            
            function stopParticleAnimation() {
                if (particleAnimationId) {
                    cancelAnimationFrame(particleAnimationId);
                    particleAnimationId = null;
                }
                isParticleAnimating = false;
            }
            
            function animateParticles() {
                if (!isParticleAnimating) return; // åœæ­¢ãƒ•ãƒ©ã‚°ãŒç«‹ã£ã¦ã„ãŸã‚‰çµ‚äº†
                
                if (!particleStartTime) particleStartTime = Date.now();
                
                const now = Date.now();
                const elapsed = (now - particleStartTime) % LOOP_DURATION;
                
                // èƒŒæ™¯ã‚¯ãƒªã‚¢
                particleCtx.fillStyle = '#000000';
                particleCtx.fillRect(0, 0, particleCanvas.width, particleCanvas.height);
                
                // ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã‚’æ›´æ–°ãƒ»æç”»
                particles.forEach(p => {
                    p.update(elapsed);
                    p.draw(particleCtx);
                });
                
                particleAnimationId = requestAnimationFrame(animateParticles);
            }

            // ========== ãƒ•ã‚¡ãƒŸã‚³ãƒ³é¢¨ãƒ­ã‚´ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ ==========
            const famicomCanvas = document.getElementById('famicomCanvas');
            const famicomCtx = famicomCanvas.getContext('2d');
            
            // 1920x1080 è¡¨ç¤º
            famicomCanvas.width = 1920;
            famicomCanvas.height = 1080;
            
            // ãƒ•ã‚¡ãƒŸã‚³ãƒ³é¢¨ã‚«ãƒ©ãƒ¼ãƒ‘ãƒ¬ãƒƒãƒˆ
            const FC_PALETTE = {
                black: '#000000',
                white: '#FCFCFC',
                red: '#F83800',
                blue: '#0058F8',
                cyan: '#00E8D8',
                green: '#00A800',
                yellow: '#F8B800',
                orange: '#FCA044',
                pink: '#F878F8',
                purple: '#6844FC'
            };
            
            // æ–‡å­—ã”ã¨ã®è‰²ï¼ˆãƒ•ã‚¡ãƒŸã‚³ãƒ³é¢¨ã«ã‚«ãƒ©ãƒ•ãƒ«ã«ï¼‰
            const famicomCharColors = [
                FC_PALETTE.cyan,    // ãµ
                FC_PALETTE.green,   // ã˜
                FC_PALETTE.yellow,  // ã¿
                FC_PALETTE.orange,  // é‡
                FC_PALETTE.pink,    // ã²
                FC_PALETTE.cyan,    // ã‹
                FC_PALETTE.green,   // ã‚Š
                FC_PALETTE.white,   // çœ¼
                FC_PALETTE.yellow   // ç§‘
            ];
            
            const famicomText = 'ãµã˜ã¿é‡ã²ã‹ã‚Šçœ¼ç§‘';
            const famicomPixelSize = 10;
            const famicomFontSize = 200;
            
            // æ–‡å­—ã®ãƒ”ã‚¯ã‚»ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
            function getFamicomTextPixels(text, fontSize) {
                const offCanvas = document.createElement('canvas');
                const offCtx = offCanvas.getContext('2d');
                
                offCanvas.width = famicomCanvas.width;
                offCanvas.height = famicomCanvas.height;
                
                offCtx.fillStyle = '#000';
                offCtx.fillRect(0, 0, offCanvas.width, offCanvas.height);
                
                offCtx.font = `bold ${fontSize}px "Hiragino Kaku Gothic Pro", "ãƒ¡ã‚¤ãƒªã‚ª", sans-serif`;
                offCtx.fillStyle = '#FFF';
                offCtx.textAlign = 'center';
                offCtx.textBaseline = 'middle';
                offCtx.fillText(text, offCanvas.width / 2, offCanvas.height / 2);
                
                const imageData = offCtx.getImageData(0, 0, offCanvas.width, offCanvas.height);
                const pixels = [];
                
                for (let y = 0; y < offCanvas.height; y += famicomPixelSize) {
                    for (let x = 0; x < offCanvas.width; x += famicomPixelSize) {
                        const i = (y * offCanvas.width + x) * 4;
                        if (imageData.data[i] > 128) {
                            const charIndex = getFamicomCharIndex(x, offCanvas.width, text.length);
                            pixels.push({
                                x: x,
                                y: y,
                                color: famicomCharColors[charIndex] || FC_PALETTE.white
                            });
                        }
                    }
                }
                
                return pixels;
            }
            
            // Xåº§æ¨™ã‹ã‚‰æ–‡å­—ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’æ¨å®š
            function getFamicomCharIndex(x, canvasWidth, charCount) {
                const textWidth = charCount * famicomFontSize * 0.9;
                const startX = (canvasWidth - textWidth) / 2;
                const charWidth = textWidth / charCount;
                const index = Math.floor((x - startX) / charWidth);
                return Math.max(0, Math.min(charCount - 1, index));
            }
            
            // ãƒ”ã‚¯ã‚»ãƒ«ãƒ‡ãƒ¼ã‚¿
            let famicomAllPixels = [];
            let famicomPixelsByRow = {};
            
            // åˆæœŸåŒ–
            function initFamicom() {
                famicomAllPixels = getFamicomTextPixels(famicomText, famicomFontSize);
                
                famicomPixelsByRow = {};
                famicomAllPixels.forEach(p => {
                    if (!famicomPixelsByRow[p.y]) {
                        famicomPixelsByRow[p.y] = [];
                    }
                    famicomPixelsByRow[p.y].push(p);
                });
            }
            
            // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³çŠ¶æ…‹
            let famicomStartTime = null;
            let famicomAnimationId = null;
            let isFamicomAnimating = false;
            const FAMICOM_LOOP_DURATION = 15000; // 15ç§’ãƒ«ãƒ¼ãƒ—
            
            // 8bité¢¨ã‚­ãƒ©ãƒªãƒ³ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
            function drawFamicomSparkle(x, y, size, progress) {
                const alpha = Math.sin(progress * Math.PI);
                famicomCtx.fillStyle = `rgba(255, 255, 255, ${alpha})`;
                
                const s = size * (0.5 + progress * 0.5);
                famicomCtx.fillRect(x - s, y - famicomPixelSize/2, s * 2, famicomPixelSize);
                famicomCtx.fillRect(x - famicomPixelSize/2, y - s, famicomPixelSize, s * 2);
            }
            
            // ã‚¹ã‚­ãƒ£ãƒ³ãƒ©ã‚¤ãƒ³åŠ¹æœ
            function drawFamicomScanlines() {
                famicomCtx.fillStyle = 'rgba(0, 0, 0, 0.1)';
                for (let y = 0; y < famicomCanvas.height; y += 4) {
                    famicomCtx.fillRect(0, y, famicomCanvas.width, 2);
                }
            }
            
            // ãƒ¡ã‚¤ãƒ³æç”»
            function drawFamicom(timestamp) {
                if (!isFamicomAnimating) return;
                
                if (!famicomStartTime) famicomStartTime = timestamp;
                const elapsed = (timestamp - famicomStartTime) % FAMICOM_LOOP_DURATION;
                const progress = elapsed / FAMICOM_LOOP_DURATION;
                
                // èƒŒæ™¯ã‚¯ãƒªã‚¢
                famicomCtx.fillStyle = FC_PALETTE.black;
                famicomCtx.fillRect(0, 0, famicomCanvas.width, famicomCanvas.height);
                
                const rows = Object.keys(famicomPixelsByRow).map(Number).sort((a, b) => b - a);
                const totalRows = rows.length;
                
                if (progress < 0.6) {
                    // ç©ã¿ä¸Šã’ãƒ•ã‚§ãƒ¼ã‚º
                    const buildProgress = progress / 0.6;
                    const rowsToShow = Math.floor(totalRows * buildProgress);
                    
                    for (let i = 0; i < rowsToShow; i++) {
                        const row = rows[i];
                        const pixels = famicomPixelsByRow[row];
                        
                        pixels.forEach(p => {
                            famicomCtx.fillStyle = p.color;
                            famicomCtx.fillRect(p.x, p.y, famicomPixelSize - 1, famicomPixelSize - 1);
                        });
                    }
                    
                    // ç¾åœ¨ç©ã¿ä¸Šã’ä¸­ã®è¡Œï¼ˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³åŠ¹æœï¼‰
                    if (rowsToShow < totalRows) {
                        const currentRow = rows[rowsToShow];
                        const rowProgress = (buildProgress * totalRows) % 1;
                        const pixels = famicomPixelsByRow[currentRow];
                        
                        pixels.forEach((p, idx) => {
                            if (idx / pixels.length < rowProgress * 1.5) {
                                famicomCtx.fillStyle = p.color;
                                const dropOffset = Math.max(0, (1 - rowProgress * 2) * 50);
                                famicomCtx.fillRect(p.x, p.y - dropOffset, famicomPixelSize - 1, famicomPixelSize - 1);
                            }
                        });
                    }
                    
                } else if (progress < 0.9) {
                    // å®Œæˆè¡¨ç¤º + ã‚­ãƒ©ãƒªãƒ³
                    
                    famicomAllPixels.forEach(p => {
                        famicomCtx.fillStyle = p.color;
                        famicomCtx.fillRect(p.x, p.y, famicomPixelSize - 1, famicomPixelSize - 1);
                    });
                    
                    // ã‚­ãƒ©ãƒªãƒ³ã‚¨ãƒ•ã‚§ã‚¯ãƒˆï¼ˆ0.6-0.75ã®é–“ï¼‰
                    if (progress < 0.75) {
                        const sparkleProgress = (progress - 0.6) / 0.15;
                        
                        const sparklePositions = [
                            { x: famicomCanvas.width * 0.2, y: famicomCanvas.height * 0.45 },
                            { x: famicomCanvas.width * 0.35, y: famicomCanvas.height * 0.5 },
                            { x: famicomCanvas.width * 0.5, y: famicomCanvas.height * 0.45 },
                            { x: famicomCanvas.width * 0.65, y: famicomCanvas.height * 0.5 },
                            { x: famicomCanvas.width * 0.8, y: famicomCanvas.height * 0.45 }
                        ];
                        
                        sparklePositions.forEach((pos, i) => {
                            const delay = i * 0.15;
                            const localProgress = Math.max(0, Math.min(1, (sparkleProgress - delay) * 2));
                            if (localProgress > 0) {
                                drawFamicomSparkle(pos.x, pos.y, 40, localProgress);
                            }
                        });
                    }
                    
                } else {
                    // ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆ
                    const fadeProgress = (progress - 0.9) / 0.1;
                    const alpha = 1 - fadeProgress;
                    
                    famicomAllPixels.forEach(p => {
                        const r = parseInt(p.color.slice(1, 3), 16);
                        const g = parseInt(p.color.slice(3, 5), 16);
                        const b = parseInt(p.color.slice(5, 7), 16);
                        famicomCtx.fillStyle = `rgba(${r}, ${g}, ${b}, ${alpha})`;
                        famicomCtx.fillRect(p.x, p.y, famicomPixelSize - 1, famicomPixelSize - 1);
                    });
                }
                
                // ã‚¹ã‚­ãƒ£ãƒ³ãƒ©ã‚¤ãƒ³åŠ¹æœï¼ˆãƒ¬ãƒˆãƒ­æ„Ÿï¼‰
                drawFamicomScanlines();
                
                // CRTã£ã½ã„å‘¨è¾ºæ¸›å…‰
                const gradient = famicomCtx.createRadialGradient(
                    famicomCanvas.width / 2, famicomCanvas.height / 2, 0,
                    famicomCanvas.width / 2, famicomCanvas.height / 2, famicomCanvas.width * 0.7
                );
                gradient.addColorStop(0, 'rgba(0, 0, 0, 0)');
                gradient.addColorStop(1, 'rgba(0, 0, 0, 0.4)');
                famicomCtx.fillStyle = gradient;
                famicomCtx.fillRect(0, 0, famicomCanvas.width, famicomCanvas.height);
                
                famicomAnimationId = requestAnimationFrame(drawFamicom);
            }
            
            function resetFamicomAnimation() {
                famicomStartTime = null;
            }
            
            function startFamicomAnimation() {
                if (isFamicomAnimating) return;
                isFamicomAnimating = true;
                resetFamicomAnimation();
                famicomAnimationId = requestAnimationFrame(drawFamicom);
            }
            
            function stopFamicomAnimation() {
                if (famicomAnimationId) {
                    cancelAnimationFrame(famicomAnimationId);
                    famicomAnimationId = null;
                }
                isFamicomAnimating = false;
            }
            
            // ãƒ•ã‚¡ãƒŸã‚³ãƒ³ãƒ­ã‚´åˆæœŸåŒ–
            initFamicom();

            // ========== å¤©æ°—äºˆå ±æ©Ÿèƒ½ ==========
            // å¤©æ°—ã‚³ãƒ¼ãƒ‰ã‹ã‚‰ã‚¢ã‚¤ã‚³ãƒ³ã¸ã®å¤‰æ›
            function getWeatherIcon(code) {
                const codeStr = String(code);
                // æ°—è±¡åºã®å¤©æ°—ã‚³ãƒ¼ãƒ‰å¯¾å¿œè¡¨
                if (codeStr.startsWith('100') || codeStr === '100') return 'â˜€ï¸';
                if (codeStr.startsWith('101')) return 'ğŸŒ¤ï¸';
                if (codeStr.startsWith('102') || codeStr.startsWith('104')) return 'â˜€ï¸â˜”';
                if (codeStr.startsWith('103') || codeStr.startsWith('105')) return 'â˜€ï¸ğŸŒ¨ï¸';
                if (codeStr.startsWith('110') || codeStr.startsWith('111')) return 'ğŸŒ¤ï¸';
                if (codeStr.startsWith('112') || codeStr.startsWith('113')) return 'ğŸŒ¤ï¸â˜”';
                if (codeStr.startsWith('114') || codeStr.startsWith('115')) return 'ğŸŒ¤ï¸ğŸŒ¨ï¸';
                if (codeStr.startsWith('200') || codeStr === '200') return 'â˜ï¸';
                if (codeStr.startsWith('201') || codeStr.startsWith('202')) return 'â˜ï¸â˜”';
                if (codeStr.startsWith('203') || codeStr.startsWith('204')) return 'â˜ï¸ğŸŒ¨ï¸';
                if (codeStr.startsWith('210') || codeStr.startsWith('211')) return 'â˜ï¸';
                if (codeStr.startsWith('212') || codeStr.startsWith('213')) return 'â˜ï¸â˜”';
                if (codeStr.startsWith('214') || codeStr.startsWith('215')) return 'â˜ï¸ğŸŒ¨ï¸';
                if (codeStr.startsWith('300') || codeStr === '300') return 'ğŸŒ§ï¸';
                if (codeStr.startsWith('301') || codeStr.startsWith('302')) return 'ğŸŒ§ï¸';
                if (codeStr.startsWith('303') || codeStr.startsWith('304')) return 'ğŸŒ§ï¸ğŸŒ¨ï¸';
                if (codeStr.startsWith('308')) return 'â›ˆï¸';
                if (codeStr.startsWith('311') || codeStr.startsWith('313')) return 'ğŸŒ§ï¸';
                if (codeStr.startsWith('314') || codeStr.startsWith('315')) return 'ğŸŒ§ï¸ğŸŒ¨ï¸';
                if (codeStr.startsWith('400') || codeStr === '400') return 'ğŸŒ¨ï¸';
                if (codeStr.startsWith('401') || codeStr.startsWith('402')) return 'ğŸŒ¨ï¸';
                if (codeStr.startsWith('403') || codeStr.startsWith('405')) return 'ğŸŒ¨ï¸ğŸŒ§ï¸';
                if (codeStr.startsWith('406') || codeStr.startsWith('407')) return 'ğŸŒ¨ï¸â›ˆï¸';
                if (codeStr.startsWith('411') || codeStr.startsWith('413')) return 'ğŸŒ¨ï¸';
                return 'ğŸŒˆ';
            }

            // æ—¥ä»˜ãƒ©ãƒ™ãƒ«ã‚’å–å¾—
            function getDayLabel(dateStr, index) {
                const date = new Date(dateStr);
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                
                const targetDate = new Date(date);
                targetDate.setHours(0, 0, 0, 0);
                
                const diffDays = Math.round((targetDate - today) / (1000 * 60 * 60 * 24));
                
                const month = date.getMonth() + 1;
                const day = date.getDate();
                const weekdays = ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'];
                const weekday = weekdays[date.getDay()];
                
                let label = '';
                if (diffDays === 0) label = 'ä»Šæ—¥';
                else if (diffDays === 1) label = 'æ˜æ—¥';
                else if (diffDays === 2) label = 'æ˜å¾Œæ—¥';
                else label = `${diffDays}æ—¥å¾Œ`;
                
                return `${label}<br>${month}/${day}(${weekday})`;
            }

            // å¤©æ°—ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ãƒ»è¡¨ç¤º
            function fetchWeatherData() {
                const weatherCardsEl = document.getElementById('weather-cards');
                const updateTimeEl = document.getElementById('weather-update-time');
                
                fetch('https://www.jma.go.jp/bosai/forecast/data/forecast/110000.json')
                    .then(response => {
                        if (!response.ok) throw new Error('Network error');
                        return response.json();
                    })
                    .then(data => {
                        // å—éƒ¨ï¼ˆãµã˜ã¿é‡å¸‚ï¼‰ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
                        const timeSeries = data[0].timeSeries;
                        
                        // å¤©æ°—æƒ…å ±ï¼ˆ3æ—¥åˆ†ï¼‰
                        const weatherData = timeSeries[0];
                        const southern = weatherData.areas.find(a => a.area.code === '110010');
                        
                        if (!southern) throw new Error('Area not found');
                        
                        const timeDefines = weatherData.timeDefines;
                        const weathers = southern.weathers;
                        const weatherCodes = southern.weatherCodes;
                        
                        // é™æ°´ç¢ºç‡ï¼ˆ6æ™‚é–“ã”ã¨ï¼‰
                        const popData = timeSeries[1];
                        const popArea = popData.areas.find(a => a.area.code === '110010');
                        const pops = popArea ? popArea.pops : [];
                        
                        // æ°—æ¸©ãƒ‡ãƒ¼ã‚¿ï¼ˆtimeDefinesã‚’å‚ç…§ã—ã¦æœ€é«˜ãƒ»æœ€ä½ã‚’æ­£ã—ãåˆ¤å®šï¼‰
                        const tempData = data[0].timeSeries[2];
                        const tempTimeDefines = tempData ? tempData.timeDefines : [];
                        const tempArea = tempData ? tempData.areas.find(a => a.area.code === '110010' || a.area.name === 'ã•ã„ãŸã¾') : null;
                        const temps = tempArea ? tempArea.temps : [];

                        // æ°—æ¸©ãƒ‡ãƒ¼ã‚¿ã‚’æ—¥ä»˜ãƒ»ç¨®åˆ¥ã”ã¨ã«æ•´ç†
                        const tempByDate = {};
                        tempTimeDefines.forEach((td, idx) => {
                            const date = new Date(td);
                            const dateKey = `${date.getFullYear()}-${date.getMonth() + 1}-${date.getDate()}`;
                            const hour = date.getHours();
                            if (!tempByDate[dateKey]) {
                                tempByDate[dateKey] = { high: null, low: null };
                            }
                            // æ™‚åˆ»ã§æœ€é«˜ãƒ»æœ€ä½ã‚’åˆ¤å®šï¼ˆ0-6æ™‚é ƒ:æœ€ä½ã€9-15æ™‚é ƒ:æœ€é«˜ï¼‰
                            if (hour >= 0 && hour <= 6) {
                                if (temps[idx] && temps[idx] !== '') {
                                    tempByDate[dateKey].low = temps[idx];
                                }
                            } else if (hour >= 9 && hour <= 15) {
                                if (temps[idx] && temps[idx] !== '') {
                                    tempByDate[dateKey].high = temps[idx];
                                }
                            }
                        });
                        
                        // ã‚«ãƒ¼ãƒ‰ã‚’ç”Ÿæˆï¼ˆãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹æ—¥æ•°åˆ†ï¼‰
                        let cardsHTML = '';
                        // æ˜å¾Œæ—¥ã®ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹ã‹ç¢ºèªï¼ˆå¤©æ°—æƒ…å ±ãŒå­˜åœ¨ã™ã‚‹ã‹ï¼‰
                        let displayDays = Math.min(3, timeDefines.length);
                        if (displayDays === 3 && (!weathers[2] || weathers[2] === '')) {
                            displayDays = 2; // æ˜å¾Œæ—¥ã®ãƒ‡ãƒ¼ã‚¿ãŒãªã‘ã‚Œã°2æ—¥åˆ†ã®ã¿è¡¨ç¤º
                        }
                        
                        for (let i = 0; i < displayDays; i++) {
                            const dayLabel = getDayLabel(timeDefines[i], i);
                            const weather = weathers[i] ? weathers[i].replace(/ã€€/g, ' ') : '---';
                            const weatherCode = weatherCodes[i];
                            const icon = getWeatherIcon(weatherCode);
                            
                            // é™æ°´ç¢ºç‡ï¼ˆãã®æ—¥ã®æœ€å¤§å€¤ã‚’è¡¨ç¤ºï¼‰
                            let maxPop = '---';
                            if (pops.length > 0) {
                                // 6æ™‚é–“ã”ã¨ã®ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰è©²å½“æ—¥ã®æœ€å¤§ã‚’å–å¾—
                                const dayPops = [];
                                if (i === 0) {
                                    // ä»Šæ—¥: æœ€åˆã®2-4å€‹
                                    for (let j = 0; j < Math.min(4, pops.length); j++) {
                                        if (pops[j] !== '') dayPops.push(parseInt(pops[j]));
                                    }
                                } else if (i === 1) {
                                    // æ˜æ—¥: 4-8å€‹ç›®
                                    for (let j = 4; j < Math.min(8, pops.length); j++) {
                                        if (pops[j] !== '') dayPops.push(parseInt(pops[j]));
                                    }
                                } else {
                                    // æ˜å¾Œæ—¥ã¯é€±é–“äºˆå ±ã‹ã‚‰ï¼ˆç°¡æ˜“è¡¨ç¤ºï¼‰
                                    maxPop = '---';
                                }
                                if (dayPops.length > 0) {
                                    maxPop = Math.max(...dayPops) + '%';
                                }
                            }
                            
                            // æ°—æ¸©ï¼ˆtimeDefinesã‚’å‚ç…§ã—ã¦æ­£ã—ãå–å¾—ï¼‰
                            let tempHigh = '---';
                            let tempLow = '---';
                            const cardDate = new Date(timeDefines[i]);
                            const cardDateKey = `${cardDate.getFullYear()}-${cardDate.getMonth() + 1}-${cardDate.getDate()}`;
                            if (tempByDate[cardDateKey]) {
                                tempHigh = tempByDate[cardDateKey].high ? tempByDate[cardDateKey].high + 'Â°' : '---';
                                tempLow = tempByDate[cardDateKey].low ? tempByDate[cardDateKey].low + 'Â°' : '---';
                            }
                            
                            cardsHTML += `
                                <div class="weather-card">
                                    <div class="weather-card-date">${dayLabel}</div>
                                    <div class="weather-card-icon">${icon}</div>
                                    <div class="weather-card-text">${weather}</div>
                                    <div class="weather-card-temps">
                                        <div class="weather-temp weather-temp-high">
                                            <div class="weather-temp-label">æœ€é«˜</div>
                                            ${tempHigh}
                                        </div>
                                        <div class="weather-temp weather-temp-low">
                                            <div class="weather-temp-label">æœ€ä½</div>
                                            ${tempLow}
                                        </div>
                                    </div>
                                    <div class="weather-card-rain">
                                        <span class="weather-card-rain-icon">â˜”</span>é™æ°´ç¢ºç‡ ${maxPop}
                                    </div>
                                </div>
                            `;
                        }
                        
                        weatherCardsEl.innerHTML = cardsHTML;
                        
                        // æ›´æ–°æ—¥æ™‚
                        const reportTime = new Date(data[0].reportDatetime);
                        updateTimeEl.textContent = `${reportTime.getMonth() + 1}/${reportTime.getDate()} ${reportTime.getHours()}:${String(reportTime.getMinutes()).padStart(2, '0')} ç™ºè¡¨`;
                        
                        weatherDataLoaded = true;
                    })
                    .catch(error => {
                        console.error('å¤©æ°—ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
                        weatherCardsEl.innerHTML = '<div class="weather-loading">â˜ï¸ ãƒ‡ãƒ¼ã‚¿å–å¾—ä¸­...</div>';
                        weatherDataLoaded = false;
                    });
            }

            // æ™‚é–“å¸¯ã«å¿œã˜ã¦å¤©æ°—ç”»é¢ã®èƒŒæ™¯ã‚’å¤‰æ›´
            function updateWeatherScreenBackground() {
                const weatherScreen = document.getElementById('weather-screen');
                const hour = new Date().getHours();

                // æ—¢å­˜ã®æ™‚é–“å¸¯ã‚¯ãƒ©ã‚¹ã‚’å‰Šé™¤
                weatherScreen.classList.remove('time-morning', 'time-noon', 'time-evening', 'time-night');

                // æ™‚é–“å¸¯ã«å¿œã˜ãŸã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ 
                if (hour >= 5 && hour < 10) {
                    weatherScreen.classList.add('time-morning');  // æœ
                } else if (hour >= 10 && hour < 16) {
                    weatherScreen.classList.add('time-noon');     // æ˜¼
                } else if (hour >= 16 && hour < 19) {
                    weatherScreen.classList.add('time-evening');  // å¤•æ–¹
                } else {
                    weatherScreen.classList.add('time-night');    // å¤œ
                }
            }

            // åˆæœŸåŒ–
            renderTable(); // ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ç”Ÿæˆ
            highlightCurrentMonthColumn();
            displayCurrentMonthInfo();
            setupPollenAlertScreen();
            updateClock();
            setInterval(updateClock, 1000); // æ™‚è¨ˆã¯å¸¸ã«æ›´æ–°(ãŸã ã—updateClockå†…ã§æ¡ä»¶åˆ¤å®š)
            // ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã¯æœ€åˆã¯é–‹å§‹ã—ãªã„(ãƒ­ã‚´ç”»é¢è¡¨ç¤ºæ™‚ã«é–‹å§‹)

            // ã‚¹ãƒ©ã‚¤ãƒ‰ã‚·ãƒ§ãƒ¼è¨­å®šã‚’èª­ã¿è¾¼ã‚“ã§ã‹ã‚‰ç”»é¢ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹
            buildScreensList().then(() => {
                rotateScreens();
            });
        });
    </script>
</body>
</html>